{"version":3,"names":["isNicknameEditing","common_vendor","ref","isPartnerIdEditing","handleNicknameEdit","value","setTimeout","handlePartnerIdEdit","handleNicknameBlur","handlePartnerIdBlur","userStore","stores_user","useUserStore","profile","nickname","partner_id","avatarFile","currentProfile","id","onLoad","_userStore$getStoredI","getStoredInfo","userInfo","utils_url","getAvatarUrl","avatarUrl","index","showToast","title","icon","navigateTo","url","chooseAvatar","_ref","_asyncToGenerator2","_regeneratorRuntime2","mark","_callee","res","wrap","_callee$","_context","prev","next","chooseImage","count","sizeType","sourceType","sent","tempFilePaths","t0","__f__","stop","apply","arguments","updateProfile","_ref2","_callee2","_callee2$","_context2","getUserInfo","submitProfile","_ref3","_callee3","_callee3$","_context3","showLoading","hideLoading","success","Error","error","message","wx","createPage","_sfc_main"],"sources":["profile.vue","cGFnZXMvcHJvZmlsZS9wcm9maWxlLnZ1ZQ"],"sourcesContent":["<script setup>\n\nimport {ref} from 'vue'\nimport {useUserStore} from '@/stores/user.js'\nimport {onLoad} from '@dcloudio/uni-app'\nimport {getAvatarUrl} from '@/utils/url.js'\n\n\nconst isNicknameEditing = ref(false)\nconst isPartnerIdEditing = ref(false)\nconst handleNicknameEdit = () => {\n  isNicknameEditing.value = true\n  setTimeout(() => {\n  }, 100)\n}\nconst handlePartnerIdEdit = () => {\n\n  isPartnerIdEditing.value = true\n}\nconst handleNicknameBlur = () => {\n  isNicknameEditing.value = false\n}\nconst handlePartnerIdBlur = () => {\n  isPartnerIdEditing.value = false\n}\nconst userStore = useUserStore()\n\nconst profile = ref({\n  nickname: '',\n  partner_id: '',\n  avatarFile: null\n})\n\nconst currentProfile = ref({\n  id: '',\n  nickname: '',\n  partner_id: '',\n  avatarFile: null\n})\n\nonLoad(() => {\n  const {userInfo} = userStore.getStoredInfo()\n\n\n  if (userInfo?.[0]) {\n    currentProfile.value = {\n      id: userInfo[0].id,\n      nickname: userInfo[0].nickname,\n      avatarFile: getAvatarUrl(userInfo[0].avatarUrl),\n      partner_id: userInfo[0].partner_id,\n    }\n  } else {\n    // 处理无用户信息的情况\n    uni.showToast({\n      title: '获取用户信息失败',\n      icon: 'none'\n    })\n    // 可能需要跳转到登录页\n    uni.navigateTo({url: '/pages/user/user'})\n  }\n})\n\n\n// 选择头像\nconst chooseAvatar = async () => {\n  try {\n    const res = await uni.chooseImage({\n      count: 1,\n      sizeType: ['compressed'],\n      sourceType: ['album', 'camera']\n    })\n    // 直接使用临时路径\n    profile.value.avatarFile = res.tempFilePaths[0]\n  } catch (error) {\n    console.error('选择图片失败：', error)\n  }\n}\n\nconst updateProfile = async () => {\n  const userInfo = await userStore.getUserInfo()\n  console.log(\"userInfo\",userInfo)\n  currentProfile.value = {\n    id: userInfo[0].id,\n    nickname: userInfo[0].nickname,\n    avatarFile: getAvatarUrl(userInfo[0].avatarUrl),\n    partner_id: userInfo[0].partner_id,\n  }\n}\n\n\n// 提交个人信息\nconst submitProfile = async () => {\n  try {\n    // 显示加载状态\n    uni.showLoading({\n      title: '更新中...'\n    })\n    console.log(profile.value)\n    const res = await userStore.updateProfile(profile.value)\n    profile.value = {\n      nickname: '',\n      partner_id: '',\n      avatarFile: null\n    }\n\n    uni.hideLoading()\n    if (res.success) {\n      uni.showToast({\n        title: '更新成功',\n        icon: 'success'\n      })\n    } else {\n      throw new Error(res.error)\n    }\n  } catch (error) {\n    uni.hideLoading()\n    uni.showToast({\n      title: error.message || '更新失败',\n      icon: 'none'\n    })\n  }\n  await updateProfile()\n}\nuni.hideLoading()\n</script>\n\n\n<template>\n  <view class=\"profile-container\">\n\n    <view class=\"avatar-section\">\n      <image :src=\"currentProfile.avatarFile\" mode=\"aspectFill\" @tap=\"chooseAvatar\"/>\n      <text>{{ currentProfile.nickname }}</text>\n    </view>\n\n\n    <view class=\"container\">\n      <!-- ID显示 -->\n      <view class=\"info-row\">\n        <text class=\"label\">你的ID:</text>\n        <text class=\"value\">{{ currentProfile.id }}</text>\n      </view>\n\n      <!-- 昵称显示/编辑 -->\n      <view class=\"info-row\">\n        <text class=\"label\">昵称:</text>\n        <view class=\"value-section\">\n          <input v-if=\"isNicknameEditing\"\n                 type=\"text\"\n                 v-model=\"profile.nickname\"\n                 placeholder=\"请输入昵称\"\n                 class=\"input-field\"\n                 @blur=\"handleNicknameBlur\"/>\n          <text v-else class=\"value\">{{ currentProfile.nickname || '未设置' }}</text>\n          <view class=\"icon-wrapper\" @tap=\"handleNicknameEdit\">\n            <uni-icons type=\"compose\"\n                       size=\"20\"\n                       color=\"#666\"\n                       class=\"edit-icon\">\n            </uni-icons>\n          </view>\n        </view>\n      </view>\n\n      <!-- 伴侣ID显示/编辑 -->\n      <view class=\"info-row\">\n        <text class=\"label\">伴侣ID:</text>\n        <view class=\"value-section\">\n          <input v-if=\"isPartnerIdEditing\"\n                 type=\"text\"\n                 v-model=\"profile.partner_id\"\n                 placeholder=\"请输入伴侣ID\"\n                 class=\"input-field\"\n                 @blur=\"handlePartnerIdBlur\"/>\n          <text v-else class=\"value\">{{ currentProfile.partner_id || '未设置' }}</text>\n          <view class=\"icon-wrapper\" @tap=\"handlePartnerIdEdit\">\n            <uni-icons type=\"compose\"\n                       size=\"20\"\n                       color=\"#666\"\n                       class=\"edit-icon\">\n            </uni-icons>\n          </view>\n        </view>\n      </view>\n    </view>\n\n\n    <!-- 提交按钮 -->\n    <button @tap=\"submitProfile\" type=\"primary\">确认修改</button>\n\n    <view>昵称：{{ currentProfile.nickname }}</view>\n    <view>伴侣id：{{ currentProfile.partner_id }}</view>\n  </view>\n</template>\n\n\n<style>\n.container {\n  padding: 30rpx;\n}\n\n.info-row {\n  display: flex;\n  align-items: center;\n  padding: 30rpx 0;\n  border-bottom: 1px solid #eee;\n}\n\n.label {\n  width: 140rpx;\n  font-size: 28rpx;\n  color: #666;\n}\n\n.value-section {\n  flex: 1;\n  display: flex;\n  align-items: center;\n}\n\n.value {\n  flex: 1;\n  font-size: 28rpx;\n  color: #333;\n}\n\n.input-field {\n  flex: 1;\n  font-size: 28rpx;\n  padding: 10rpx 0;\n  border-bottom: 1px solid #007AFF;\n}\n\n.edit-icon {\n  margin-left: 20rpx;\n  padding: 10rpx;\n}\n\n/* 点击状态 */\n.edit-icon:active {\n  opacity: 0.7;\n}\n\n\n.avatar-section {\n  background-image: url('/static/testImage/classify1.jpg');\n  background-size: cover;\n  background-position: center;\n  height: 450rpx;\n  display: flex;\n  flex-direction: column;\n  justify-content: center;\n  align-items: center;\n  position: relative;\n}\n\n\n.avatar-section::before {\n  content: '';\n  position: absolute;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  backdrop-filter: blur(8px);\n  -webkit-backdrop-filter: blur(8px);\n  z-index: 1;\n}\n\n\n.avatar-section image,\n.avatar-section text {\n  position: relative;\n  z-index: 2;\n}\n\n.avatar-section text {\n  color: #fff;\n  font-size: 42rpx;\n  font-weight: bold;\n}\n\n\n.avatar-section image {\n  width: 150px;\n  height: 150px;\n  border-radius: 50%;\n  margin-bottom: 40rpx;\n}\n\n</style>\n","import MiniProgramPage from 'C:/Users/ADMIN/Documents/HBuilderProjects/宝宝照片/pages/profile/profile.vue'\nwx.createPage(MiniProgramPage)"],"mappings":"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","ignoreList":[]}