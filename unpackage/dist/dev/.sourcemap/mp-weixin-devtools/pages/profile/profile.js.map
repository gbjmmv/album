{"version":3,"names":["isAvatarChanged","common_vendor","ref","isNicknameEditing","isPartnerIdEditing","handleNicknameEdit","value","setTimeout","watchEffect","index","__f__","currentProfile","avatarFile","handlePartnerIdEdit","handleNicknameBlur","handlePartnerIdBlur","userStore","stores_user","useUserStore","profile","nickname","partner_id","id","onLoad","_userStore$getStoredI","getStoredInfo","userInfo","utils_url","getAvatarUrl","avatarUrl","showToast","title","icon","navigateTo","url","onShow","_asyncToGenerator2","_regeneratorRuntime2","mark","_callee","wrap","_callee$","_context","prev","next","getUserInfo","sent","stop","chooseAvatar","_ref2","_callee2","res","_callee2$","_context2","chooseImage","count","sizeType","sourceType","tempFilePaths","t0","apply","arguments","updateProfile","_ref3","_callee3","_callee3$","_context3","submitProfile","_ref4","_callee4","_callee4$","_context4","showLoading","hideLoading","success","Error","error","message","wx","createPage","_sfc_main"],"sources":["profile.vue","cGFnZXMvcHJvZmlsZS9wcm9maWxlLnZ1ZQ"],"sourcesContent":["<script setup>\nimport {ref,computed,watch,watchEffect} from 'vue'\nimport {useUserStore} from '@/stores/user.js'\nimport {onLoad, onShow} from '@dcloudio/uni-app'\nimport {getAvatarUrl} from '@/utils/url.js'\nconst isAvatarChanged = ref(false)\nconst isNicknameEditing = ref(false)\nconst isPartnerIdEditing = ref(false)\nconst handleNicknameEdit = () => {\n  isNicknameEditing.value = true\n  setTimeout(() => {\n  }, 100)\n}\n\nwatchEffect(()=>{\n  console.log('Current avatar:', currentProfile.value.avatarFile)\n  console.log('Is avatar changed:', isAvatarChanged.value)\n})\nconst handlePartnerIdEdit = () => {\n  isPartnerIdEditing.value = true\n}\nconst handleNicknameBlur = () => {\n  isNicknameEditing.value = false\n}\nconst handlePartnerIdBlur = () => {\n  isPartnerIdEditing.value = false\n}\n\n\nconst userStore = useUserStore()\nconst profile = ref({\n  nickname: '',\n  partner_id: '',\n  avatarFile: null\n})\n\nconst currentProfile = ref({\n  id: '',\n  nickname: '',\n  partner_id: '',\n  avatarFile: null\n})\n\n\nonLoad(() => {\n  const {userInfo} = userStore.getStoredInfo()\n  if (userInfo?.[0]) {\n    currentProfile.value = {\n      id: userInfo[0].id,\n      nickname: userInfo[0].nickname,\n      avatarFile: getAvatarUrl(userInfo[0].avatarUrl),\n      partner_id: userInfo[0].partner_id,\n    }\n  } else {\n    uni.showToast({\n      title: '获取用户信息失败',\n      icon: 'none'\n    })\n    uni.navigateTo({url: '/pages/user/user'})\n  }\n})\nonShow(async () => {\n  // 如果头像已更改，不要覆盖\n  if (!isAvatarChanged.value) {\n    const userInfo = await userStore.getUserInfo()\n    currentProfile.value = {\n      id: userInfo[0].id,\n      nickname: userInfo[0].nickname,\n      avatarFile: getAvatarUrl(userInfo[0].avatarUrl),\n      partner_id: userInfo[0].partner_id,\n    }\n  }\n})\n\n\n// 选择头像\nconst chooseAvatar = async () => {\n  try {\n    const res = await uni.chooseImage({\n      count: 1,\n      sizeType: ['compressed'],\n      sourceType: ['album', 'camera']\n    })\n\n    profile.value.avatarFile = res.tempFilePaths[0]\n    console.log(\"currentProfile.value.avatarFile1:\",currentProfile.value.avatarFile)\n    currentProfile.value.avatarFile = res.tempFilePaths[0]\n    console.log(\"currentProfile.value.avatarFile2:\",currentProfile.value.avatarFile)\n    console.log(\"res.tempFilePaths[0]: \",res.tempFilePaths[0])\n  } catch (error) {\n    console.error('选择图片失败：', error)\n  }\n}\nconst updateProfile = async () => {\n  const userInfo = await userStore.getUserInfo()\n  console.log(\"userInfo\", userInfo)\n  currentProfile.value = {\n    id: userInfo[0].id,\n    nickname: userInfo[0].nickname,\n    avatarFile: getAvatarUrl(userInfo[0].avatarUrl),\n    partner_id: userInfo[0].partner_id,\n  }\n}\n// 提交个人信息\nconst submitProfile = async () => {\n  try {\n    // 显示加载状态\n    uni.showLoading({\n      title: '更新中...'\n    })\n    const res = await userStore.updateProfile(profile.value)\n    isAvatarChanged.value = false // 重置标志位\n    profile.value = {\n      nickname: '',\n      partner_id: '',\n      avatarFile: null\n    }\n    uni.hideLoading()\n    if (res.success) {\n      uni.showToast({\n        title: '更新成功',\n        icon: 'success'\n      })\n    } else {\n      throw new Error(res.error)\n    }\n\n\n  } catch (error) {\n    uni.hideLoading()\n    uni.showToast({\n      title: error.message || '更新失败',\n      icon: 'none'\n    })\n  }\n  await updateProfile()\n}\nuni.hideLoading()\n</script>\n\n<template>\n  <view class=\"profile-container\">\n\n    <view class=\"avatar-section\">\n      <image :src=\"currentProfile.avatarFile\" mode=\"aspectFill\" @tap=\"chooseAvatar\"/>\n      <text>{{ currentProfile.nickname }}</text>\n    </view>\n\n\n    <view class=\"container\">\n      <!-- ID显示 -->\n      <view class=\"info-row\">\n        <text class=\"label\">你的ID:</text>\n        <text class=\"value\">{{ currentProfile.id }}</text>\n      </view>\n\n      <!-- 昵称显示/编辑 -->\n      <view class=\"info-row\">\n        <text class=\"label\">昵称:</text>\n        <view class=\"value-section\">\n          <input v-if=\"isNicknameEditing\"\n                 type=\"text\"\n                 v-model=\"profile.nickname\"\n                 placeholder=\"请输入昵称\"\n                 class=\"input-field\"\n                 @blur=\"handleNicknameBlur\"/>\n          <text v-else class=\"value\">{{ currentProfile.nickname || '未设置' }}</text>\n          <view class=\"icon-wrapper\" @tap=\"handleNicknameEdit\">\n            <uni-icons type=\"compose\"\n                       size=\"20\"\n                       color=\"#666\"\n                       class=\"edit-icon\">\n            </uni-icons>\n          </view>\n        </view>\n      </view>\n\n      <!-- 伴侣ID显示/编辑 -->\n      <view class=\"info-row\">\n        <text class=\"label\">伴侣ID:</text>\n        <view class=\"value-section\">\n          <input v-if=\"isPartnerIdEditing\"\n                 type=\"text\"\n                 v-model=\"profile.partner_id\"\n                 placeholder=\"请输入伴侣ID\"\n                 class=\"input-field\"\n                 @blur=\"handlePartnerIdBlur\"/>\n          <text v-else class=\"value\">{{ currentProfile.partner_id || '未设置' }}</text>\n          <view class=\"icon-wrapper\" @tap=\"handlePartnerIdEdit\">\n            <uni-icons type=\"compose\"\n                       size=\"20\"\n                       color=\"#666\"\n                       class=\"edit-icon\">\n            </uni-icons>\n          </view>\n        </view>\n      </view>\n    </view>\n\n\n    <!-- 提交按钮 -->\n    <button @tap=\"submitProfile\" type=\"primary\">确认修改</button>\n  </view>\n</template>\n\n\n<style>\n.container {\n  padding: 30rpx;\n}\n\n.info-row {\n  display: flex;\n  align-items: center;\n  padding: 30rpx 0;\n  border-bottom: 1px solid #eee;\n}\n\n.label {\n  width: 140rpx;\n  font-size: 28rpx;\n  color: #666;\n}\n\n.value-section {\n  flex: 1;\n  display: flex;\n  align-items: center;\n}\n\n.value {\n  flex: 1;\n  font-size: 28rpx;\n  color: #333;\n}\n\n.input-field {\n  flex: 1;\n  font-size: 28rpx;\n  padding: 10rpx 0;\n  border-bottom: 1px solid #007AFF;\n}\n\n.edit-icon {\n  margin-left: 20rpx;\n  padding: 10rpx;\n}\n\n/* 点击状态 */\n.edit-icon:active {\n  opacity: 0.7;\n}\n\n\n.avatar-section {\n  background: linear-gradient(to bottom, skyblue, white);\n  background-size: cover;\n  background-position: center;\n  height: 450rpx;\n  display: flex;\n  flex-direction: column;\n  justify-content: center;\n  align-items: center;\n  position: relative;\n}\n\n\n.avatar-section::before {\n  content: '';\n  position: absolute;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  backdrop-filter: blur(8px);\n  -webkit-backdrop-filter: blur(8px);\n  z-index: 1;\n}\n\n\n.avatar-section image,\n.avatar-section text {\n  position: relative;\n  z-index: 2;\n}\n\n.avatar-section text {\n  color: #000000;\n  font-size: 42rpx;\n  font-weight: bold;\n}\n\n\n.avatar-section image {\n  width: 150px;\n  height: 150px;\n  border-radius: 50%;\n  margin-bottom: 40rpx;\n}\n\n</style>\n","import MiniProgramPage from 'C:/Users/ADMIN/Documents/HBuilderProjects/album/pages/profile/profile.vue'\nwx.createPage(MiniProgramPage)"],"mappings":"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","ignoreList":[]}