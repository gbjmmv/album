{"version":3,"names":["isSelectMode","common_vendor","ref","selectedPhotoIds","favoritePopup","photoStore","stores_photo","usePhotoStore","photos","computed","res","favoritePhotos","index","__f__","isLoading","onShow","fetchFavorites","onLoad","_ref","_asyncToGenerator2","_regeneratorRuntime2","mark","_callee","wrap","_callee$","_context","prev","next","getFavoritePhotos","stop","apply","arguments","enterSelectMode","value","cancelSelect","toggleSelect","photo","findIndex","id","splice","push","isPhotoSelected","includes","viewPhoto","navigateTo","url","concat","showDeleteConfirm","open","closeFavoritePopup","close","confirmRemoveFavorites","_ref2","_callee2","success","_iterator","_step","photoId","result","_callee2$","_context2","length","abrupt","_createForOfIteratorHelper2","s","n","done","toggleFavorite","sent","t0","e","f","finish","showToast","title","icon","wx","createPage","_sfc_main"],"sources":["FavoritesPage.vue","cGFnZXMvRmF2b3JpdGVzUGFnZS9GYXZvcml0ZXNQYWdlLnZ1ZQ"],"sourcesContent":["<script setup>\nimport { ref, computed, onMounted } from 'vue';\nimport { onLoad, onShow } from '@dcloudio/uni-app';\nimport { usePhotoStore } from '@/stores/photo.js';\nimport { getAvatarUrl } from '@/utils/url.js';\n\n// 状态\nconst isSelectMode = ref(false);\nconst selectedPhotoIds = ref([]);\nconst favoritePopup = ref(null);\n// 获取照片store\nconst photoStore = usePhotoStore();\nconst photos = computed(() => {\n  const res = photoStore.favoritePhotos\n  console.log(\"res\",res)\n  return res\n});\nconst isLoading = computed(() => photoStore.isLoading);\n\n// 每次显示页面时刷新数据\nonShow(() => {\n  fetchFavorites();\n});\n\nonLoad(()=>{\n  fetchFavorites();\n})\n\n// 加载收藏的照片\nconst fetchFavorites = async () => {\n  await photoStore.getFavoritePhotos();\n};\n\n// 进入照片选择模式\nconst enterSelectMode = () => {\n  isSelectMode.value = true;\n  selectedPhotoIds.value = [];\n};\n\n// 取消选择模式\nconst cancelSelect = () => {\n  isSelectMode.value = false;\n  selectedPhotoIds.value = [];\n};\n\n// 切换照片选择状态\nconst toggleSelect = (photo) => {\n  const index = selectedPhotoIds.value.findIndex(id => id === photo.id);\n  if (index > -1) {\n    selectedPhotoIds.value.splice(index, 1);\n  } else {\n    selectedPhotoIds.value.push(photo.id);\n  }\n};\n\n// 判断照片是否已选中\nconst isPhotoSelected = (photo) => {\n  return selectedPhotoIds.value.includes(photo.id);\n};\n\n// 查看照片\nconst viewPhoto = (photo, index) => {\n  // 导航到照片详情页，传递照片ID和当前照片列表索引\n  // 特殊处理：传递source=favorites表示来源是收藏页面\n  uni.navigateTo({\n    url: `/pages/PhotoDetail/PhotoDetail?id=${photo.id}&index=${index}&source=favorites`\n  });\n};\n\n// 显示取消收藏确认弹窗\nconst showDeleteConfirm = () => {\n  if (!favoritePopup.value) return;\n  favoritePopup.value.open();\n};\n\n// 关闭取消收藏确认弹窗\nconst closeFavoritePopup = () => {\n  if (!favoritePopup.value) return;\n  favoritePopup.value.close();\n};\n\n// 确认取消收藏选中照片\nconst confirmRemoveFavorites = async () => {\n  if (selectedPhotoIds.value.length === 0) return;\n\n  let success = true;\n  for (const photoId of selectedPhotoIds.value) {\n    const result = await photoStore.toggleFavorite(photoId);\n    if (!result) {\n      success = false;\n    }\n  }\n\n  if (success) {\n    // 刷新收藏列表\n    await photoStore.getFavoritePhotos();\n\n    // 清空选中照片\n    selectedPhotoIds.value = [];\n    // 退出选择模式\n    isSelectMode.value = false;\n\n    uni.showToast({\n      title: '取消收藏成功',\n      icon: 'success'\n    });\n  }\n\n  closeFavoritePopup();\n};\n</script>\n\n\n<template>\n  <view class=\"favorites-page\">\n    <view class=\"header\">\n      <view class=\"title\">我的收藏</view>\n      <view class=\"actions\" v-if=\"photos.length > 0\">\n        <button v-if=\"isSelectMode\" @click=\"cancelSelect\" class=\"cancel-btn\">取消</button>\n        <button v-else @click=\"enterSelectMode\" class=\"select-btn\">选择</button>\n        <button v-if=\"isSelectMode && selectedPhotoIds.length > 0\" @click=\"showDeleteConfirm\" class=\"delete-btn\">取消收藏({{ selectedPhotoIds.length }})</button>\n      </view>\n    </view>\n\n    <view class=\"photos-grid\" v-if=\"photos.length > 0\">\n      <view\n          v-for=\"(photo, index) in photos\"\n          :key=\"photo.id\"\n          class=\"photo-item\"\n          @click=\"isSelectMode ? toggleSelect(photo) : viewPhoto(photo, index)\"\n      >\n        <image :src=\"getAvatarUrl(photo.url)\" mode=\"aspectFill\" class=\"photo-image\" />\n        <view v-if=\"isSelectMode\" class=\"select-overlay\" :class=\"{ selected: isPhotoSelected(photo) }\">\n          <uni-icons v-if=\"isPhotoSelected(photo)\" type=\"checkbox-filled\" size=\"24\" color=\"#FFFFFF\" />\n        </view>\n      </view>\n    </view>\n\n    <!-- 空状态提示 -->\n    <view v-if=\"!isLoading && photos.length === 0\" class=\"empty-state\">\n      <image src=\"/static/images/empty-favorites.png\" mode=\"aspectFit\" class=\"empty-image\" />\n      <text class=\"empty-text\">暂无收藏的照片</text>\n      <text class=\"empty-subtext\">浏览相册时点击收藏按钮即可收藏照片</text>\n    </view>\n\n    <!-- 加载状态 -->\n    <uni-load-more v-if=\"isLoading\" status=\"loading\" />\n\n    <!-- 删除确认弹窗 -->\n    <uni-popup ref=\"favoritePopup\" type=\"dialog\">\n      <uni-popup-dialog\n          type=\"warning\"\n          title=\"取消收藏\"\n          content=\"确定要取消收藏所选照片吗？\"\n          :before-close=\"true\"\n          @confirm=\"confirmRemoveFavorites\"\n          @close=\"closeFavoritePopup\"\n      />\n    </uni-popup>\n  </view>\n</template>\n\n\n\n<style>\n.favorites-page {\n  padding: 20rpx;\n  min-height: 100vh;\n}\n\n.header {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: 30rpx;\n}\n\n.title {\n  font-size: 36rpx;\n  font-weight: bold;\n}\n\n.actions {\n  display: flex;\n  gap: 20rpx;\n}\n\n.select-btn, .cancel-btn, .delete-btn {\n  font-size: 28rpx;\n  padding: 6rpx 20rpx;\n  border-radius: 30rpx;\n}\n\n.select-btn {\n  background-color: #f8f8f8;\n  color: #333;\n}\n\n.cancel-btn {\n  background-color: #f0f0f0;\n  color: #666;\n}\n\n.delete-btn {\n  background-color: #ff4d4f;\n  color: #fff;\n}\n\n.photos-grid {\n  display: flex;\n  flex-wrap: wrap;\n  margin: -5rpx;\n}\n\n.photo-item {\n  position: relative;\n  width: calc(33.333% - 10rpx);\n  padding-bottom: calc(33.333% - 10rpx);\n  margin: 5rpx;\n  overflow: hidden;\n}\n\n.photo-image {\n  position: absolute;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n  object-fit: cover;\n}\n\n.select-overlay {\n  position: absolute;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background-color: rgba(0, 0, 0, 0.2);\n  display: flex;\n  justify-content: center;\n  align-items: center;\n}\n\n.select-overlay.selected {\n  background-color: rgba(0, 0, 0, 0.5);\n  border: 4rpx solid #1890ff;\n}\n\n.empty-state {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  padding: 100rpx 0;\n}\n\n.empty-image {\n  width: 200rpx;\n  height: 200rpx;\n  margin-bottom: 20rpx;\n}\n\n.empty-text {\n  color: #666;\n  font-size: 32rpx;\n  margin-bottom: 10rpx;\n}\n\n.empty-subtext {\n  color: #999;\n  font-size: 26rpx;\n}\n</style>\n","import MiniProgramPage from 'C:/Users/ADMIN/Documents/HBuilderProjects/宝宝照片/pages/FavoritesPage/FavoritesPage.vue'\nwx.createPage(MiniProgramPage)"],"mappings":"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","ignoreList":[]}