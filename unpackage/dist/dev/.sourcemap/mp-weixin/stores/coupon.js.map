{"version":3,"file":"coupon.js","sources":["stores/coupon.js"],"sourcesContent":["// src/stores/coupon.js\r\nimport { defineStore } from 'pinia'\r\nimport { ref } from 'vue'\r\nimport { couponApi } from '@/api/coupon'\r\n\r\nexport const useCouponStore = defineStore('coupon', () => {\r\n    // 状态\r\n    const pendingUse = ref([]) // 待使用的券（我收到的）\r\n    const pendingRedeem = ref([]) // 待兑现的券（我创建的）\r\n    const completed = ref([]) // 已完成的券\r\n    const loading = ref(false)\r\n\r\n    // 获取所有兑换券并分类\r\n    const fetchCoupons = async () => {\r\n        loading.value = true\r\n        try {\r\n            const result = await couponApi.getCoupons()\r\n            console.log(\"result.data.pendingRedeem:\",result.data.pendingRedeem)\r\n            if (result.code === 0) {\r\n                pendingUse.value = result.data.pendingUse || []\r\n                pendingRedeem.value = result.data.pendingRedeem || []\r\n                completed.value = result.data.completed || []\r\n            }\r\n        } catch (error) {\r\n            console.error('获取兑换券失败:', error)\r\n            uni.showToast({\r\n                title: '获取兑换券失败',\r\n                icon: 'none'\r\n            })\r\n        } finally {\r\n            loading.value = false\r\n        }\r\n    }\r\n\r\n    // 创建兑换券\r\n    const createCoupon = async (couponData) => {\r\n        try {\r\n            console.log('createCoupon:', couponData)\r\n            const result = await couponApi.createCoupon(couponData)\r\n            if (result.code === 0) {\r\n                await fetchCoupons() // 刷新列表\r\n                return true\r\n            }\r\n            return false\r\n        } catch (error) {\r\n            console.error('创建兑换券失败:', error)\r\n            uni.showToast({\r\n                title: '创建兑换券失败',\r\n                icon: 'none'\r\n            })\r\n            return false\r\n        }\r\n    }\r\n\r\n    // 完成兑换券\r\n    const completeCoupon = async (id) => {\r\n        try {\r\n            const result = await couponApi.completeCoupon(id)\r\n            if (result.code === 0) {\r\n                await fetchCoupons() // 刷新列表\r\n                return true\r\n            }\r\n            return false\r\n        } catch (error) {\r\n            console.error('完成兑换券失败:', error)\r\n            uni.showToast({\r\n                title: '完成兑换券失败',\r\n                icon: 'none'\r\n            })\r\n            return false\r\n        }\r\n    }\r\n\r\n    // 删除兑换券\r\n    const deleteCoupon = async (id) => {\r\n        try {\r\n            const result = await couponApi.deleteCoupon(id)\r\n            if (result.code === 0) {\r\n                await fetchCoupons() // 刷新列表\r\n                return true\r\n            }\r\n            return false\r\n        } catch (error) {\r\n            console.error('删除兑换券失败:', error)\r\n            uni.showToast({\r\n                title: '删除兑换券失败',\r\n                icon: 'none'\r\n            })\r\n            return false\r\n        }\r\n    }\r\n\r\n    return {\r\n        pendingUse,\r\n        pendingRedeem,\r\n        completed,\r\n        loading,\r\n        fetchCoupons,\r\n        createCoupon,\r\n        completeCoupon,\r\n        deleteCoupon\r\n    }\r\n})"],"names":["defineStore","ref","couponApi","uni"],"mappings":";;;AAKY,MAAC,iBAAiBA,cAAAA,YAAY,UAAU,MAAM;AAEtD,QAAM,aAAaC,cAAG,IAAC,EAAE;AACzB,QAAM,gBAAgBA,cAAG,IAAC,EAAE;AAC5B,QAAM,YAAYA,cAAG,IAAC,EAAE;AACxB,QAAM,UAAUA,cAAG,IAAC,KAAK;AAGzB,QAAM,eAAe,YAAY;AAC7B,YAAQ,QAAQ;AAChB,QAAI;AACA,YAAM,SAAS,MAAMC,WAAS,UAAC,WAAY;AAC3CC,oBAAA,MAAA,MAAA,OAAA,0BAAY,8BAA6B,OAAO,KAAK,aAAa;AAClE,UAAI,OAAO,SAAS,GAAG;AACnB,mBAAW,QAAQ,OAAO,KAAK,cAAc,CAAE;AAC/C,sBAAc,QAAQ,OAAO,KAAK,iBAAiB,CAAE;AACrD,kBAAU,QAAQ,OAAO,KAAK,aAAa,CAAE;AAAA,MAChD;AAAA,IACJ,SAAQ,OAAO;AACZA,oBAAAA,MAAA,MAAA,SAAA,0BAAc,YAAY,KAAK;AAC/BA,oBAAAA,MAAI,UAAU;AAAA,QACV,OAAO;AAAA,QACP,MAAM;AAAA,MACtB,CAAa;AAAA,IACb,UAAkB;AACN,cAAQ,QAAQ;AAAA,IACnB;AAAA,EACJ;AAGD,QAAM,eAAe,OAAO,eAAe;AACvC,QAAI;AACAA,oBAAAA,6CAAY,iBAAiB,UAAU;AACvC,YAAM,SAAS,MAAMD,qBAAU,aAAa,UAAU;AACtD,UAAI,OAAO,SAAS,GAAG;AACnB,cAAM,aAAc;AACpB,eAAO;AAAA,MACV;AACD,aAAO;AAAA,IACV,SAAQ,OAAO;AACZC,oBAAAA,MAAA,MAAA,SAAA,0BAAc,YAAY,KAAK;AAC/BA,oBAAAA,MAAI,UAAU;AAAA,QACV,OAAO;AAAA,QACP,MAAM;AAAA,MACtB,CAAa;AACD,aAAO;AAAA,IACV;AAAA,EACJ;AAGD,QAAM,iBAAiB,OAAO,OAAO;AACjC,QAAI;AACA,YAAM,SAAS,MAAMD,qBAAU,eAAe,EAAE;AAChD,UAAI,OAAO,SAAS,GAAG;AACnB,cAAM,aAAc;AACpB,eAAO;AAAA,MACV;AACD,aAAO;AAAA,IACV,SAAQ,OAAO;AACZC,oBAAAA,MAAA,MAAA,SAAA,0BAAc,YAAY,KAAK;AAC/BA,oBAAAA,MAAI,UAAU;AAAA,QACV,OAAO;AAAA,QACP,MAAM;AAAA,MACtB,CAAa;AACD,aAAO;AAAA,IACV;AAAA,EACJ;AAGD,QAAM,eAAe,OAAO,OAAO;AAC/B,QAAI;AACA,YAAM,SAAS,MAAMD,qBAAU,aAAa,EAAE;AAC9C,UAAI,OAAO,SAAS,GAAG;AACnB,cAAM,aAAc;AACpB,eAAO;AAAA,MACV;AACD,aAAO;AAAA,IACV,SAAQ,OAAO;AACZC,oBAAAA,MAAA,MAAA,SAAA,0BAAc,YAAY,KAAK;AAC/BA,oBAAAA,MAAI,UAAU;AAAA,QACV,OAAO;AAAA,QACP,MAAM;AAAA,MACtB,CAAa;AACD,aAAO;AAAA,IACV;AAAA,EACJ;AAED,SAAO;AAAA,IACH;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,EACH;AACL,CAAC;;"}