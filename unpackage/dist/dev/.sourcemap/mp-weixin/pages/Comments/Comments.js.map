{"version":3,"file":"Comments.js","sources":["pages/Comments/Comments.vue","../../HBuilderX.4.45.2025010502/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvQ29tbWVudHMvQ29tbWVudHMudnVl"],"sourcesContent":["<script setup>\nimport {ref, onMounted, nextTick} from 'vue';\nimport {onPullDownRefresh, onReachBottom} from '@dcloudio/uni-app';\nimport {useCommentStore} from '@/stores/commentStore';\nimport CommentOptions from '@/components/comment-options/comment-options.vue'\n// 加载状态文本\nconst loadingText = {\n  contentdown: '上拉加载更多',\n  contentrefresh: '加载中...',\n  contentnomore: '没有更多了'\n};\n\n// 使用评论Store\nconst commentStore = useCommentStore();\n\n// 选中的评论相关数据\nconst selectedComment = ref(null);\nconst commentOptionsRef = ref(null);\n\n// 页面初始化时加载评论数据\nonMounted(() => {\n  commentStore.fetchUserComments(true);\n});\n\n// 监听下拉刷新\nonPullDownRefresh(() => {\n  commentStore.refreshComments();\n  setTimeout(() => {\n    uni.stopPullDownRefresh();\n  }, 1000);\n});\n\n// 监听页面滚动到底部\nonReachBottom(() => {\n  if (commentStore.hasMore) {\n    commentStore.loadMore();\n  }\n});\n\n// 格式化日期\nconst formatDate = (dateString) => {\n  if (!dateString) return '';\n\n  const date = new Date(dateString);\n\n  // 始终显示年月日和具体时间 (YYYY-MM-DD HH:MM)\n  return date.getFullYear() + '-' +\n      (date.getMonth() + 1).toString().padStart(2, '0') + '-' +\n      date.getDate().toString().padStart(2, '0') + ' ' +\n      date.getHours().toString().padStart(2, '0') + ':' +\n      date.getMinutes().toString().padStart(2, '0');\n};\n\n// 预览图片\nconst previewImage = (url) => {\n  uni.previewImage({\n    urls: [url],\n    current: url\n  });\n};\n\n// 显示评论操作选项\nconst showCommentOptions = (comment) => {\n  console.log(\"页面comment.content: \",comment.content);\n  selectedComment.value = comment;\n  nextTick(() => {\n    commentOptionsRef.value.open(comment);\n  });\n};\n\n// 处理评论更新\nconst handleCommentUpdate = async (commentData) => {\n  await commentStore.updateComment(commentData);\n};\n\n// 处理评论删除\nconst handleCommentDelete = async (commentData) => {\n  await commentStore.deleteComment(commentData);\n};\n</script>\n\n\n<template>\n  <view class=\"comments-container\">\n    <view v-if=\"commentStore.loading\" class=\"loading-container\">\n      <uni-load-more status=\"loading\" :content-text=\"loadingText\"></uni-load-more>\n    </view>\n\n    <view v-else-if=\"commentStore.isEmpty\" class=\"empty-container\">\n      <text class=\"empty-text\">暂无评论记录</text>\n    </view>\n\n    <view v-else class=\"photo-comments-list\">\n      <!-- 照片和评论部分，每次加载10个 -->\n      <view\n          v-for=\"(item, index) in commentStore.photoComments\"\n          :key=\"item.id\"\n          class=\"photo-comment-item\"\n      >\n        <view class=\"item-header\">\n          <text class=\"album-name\">{{ item.subAlbumName }}</text>\n        </view>\n\n        <view class=\"item-content\">\n          <!-- 左侧照片部分 -->\n          <view class=\"photo-container\">\n            <image\n                class=\"photo\"\n                :src=\"item.url\"\n                mode=\"aspectFill\"\n                @click=\"previewImage(item.url)\"\n            ></image>\n          </view>\n\n          <!-- 右侧评论列表部分 -->\n          <view class=\"comments-list\">\n            <view\n                v-for=\"(comment, cIndex) in item.comments\"\n                :key=\"comment.id\"\n                class=\"comment-item\"\n                @longpress=\"showCommentOptions(comment)\"\n            >\n              <text class=\"comment-content\">{{ comment.content }}</text>\n              <text class=\"comment-time\">{{ formatDate(comment.createdAt) }}</text>\n            </view>\n          </view>\n        </view>\n      </view>\n\n      <!-- 加载更多 -->\n      <view v-if=\"commentStore.hasMore\" class=\"load-more\">\n        <uni-load-more\n            :status=\"commentStore.loadMoreStatus\"\n            @clickLoadMore=\"commentStore.loadMore\"\n        ></uni-load-more>\n      </view>\n    </view>\n\n    <!-- 使用复用的评论操作组件 -->\n    <comment-options\n        ref=\"commentOptionsRef\"\n        :comment-data=\"selectedComment\"\n        @update=\"handleCommentUpdate\"\n        @delete=\"handleCommentDelete\"\n    />\n  </view>\n</template>\n\n\n<style>\n.comments-container {\n  padding: 20rpx;\n  background-color: #f8f8f8;\n  min-height: 100vh;\n}\n\n.loading-container, .empty-container {\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  height: 300rpx;\n}\n\n.empty-text {\n  color: #999;\n  font-size: 28rpx;\n}\n\n.photo-comments-list {\n  margin-bottom: 30rpx;\n}\n\n.photo-comment-item {\n  margin-bottom: 30rpx;\n  border-radius: 12rpx;\n  background-color: #ffffff;\n  box-shadow: 0 2rpx 12rpx rgba(0, 0, 0, 0.05);\n  overflow: hidden;\n}\n\n.item-header {\n  padding: 20rpx 24rpx;\n  border-bottom: 1rpx solid #f0f0f0;\n}\n\n.album-name {\n  font-size: 28rpx;\n  color: #333;\n  font-weight: 500;\n}\n\n.item-content {\n  display: flex;\n  padding: 24rpx;\n}\n\n.photo-container {\n  width: 200rpx;\n  height: 200rpx;\n  margin-right: 24rpx;\n  flex-shrink: 0;\n}\n\n.photo {\n  width: 100%;\n  height: 100%;\n  border-radius: 8rpx;\n}\n\n.comments-list {\n  flex: 1;\n  overflow: hidden;\n}\n\n.comment-item {\n  padding: 16rpx 0;\n  border-bottom: 1rpx solid #f5f5f5;\n}\n\n.comment-item:last-child {\n  border-bottom: none;\n}\n\n.comment-content {\n  font-size: 28rpx;\n  color: #333;\n  line-height: 1.5;\n  word-break: break-all;\n}\n\n.comment-time {\n  display: block;\n  font-size: 24rpx;\n  color: #999;\n  margin-top: 8rpx;\n}\n\n.load-more {\n  padding: 30rpx 0;\n  text-align: center;\n}\n</style>","import MiniProgramPage from 'C:/Users/ADMIN/Documents/HBuilderProjects/album/pages/Comments/Comments.vue'\nwx.createPage(MiniProgramPage)"],"names":["useCommentStore","ref","onMounted","onPullDownRefresh","uni","onReachBottom","nextTick","MiniProgramPage"],"mappings":";;;;;;;;;;;AAIA,MAAM,iBAAiB,MAAW;;;;AAElC,UAAM,cAAc;AAAA,MAClB,aAAa;AAAA,MACb,gBAAgB;AAAA,MAChB,eAAe;AAAA,IACjB;AAGA,UAAM,eAAeA,oBAAe,gBAAA;AAGpC,UAAM,kBAAkBC,cAAAA,IAAI,IAAI;AAChC,UAAM,oBAAoBA,cAAAA,IAAI,IAAI;AAGlCC,kBAAAA,UAAU,MAAM;AACd,mBAAa,kBAAkB,IAAI;AAAA,IACrC,CAAC;AAGDC,kBAAAA,kBAAkB,MAAM;AACtB,mBAAa,gBAAe;AAC5B,iBAAW,MAAM;AACfC,sBAAG,MAAC,oBAAmB;AAAA,MACxB,GAAE,GAAI;AAAA,IACT,CAAC;AAGDC,kBAAAA,cAAc,MAAM;AAClB,UAAI,aAAa,SAAS;AACxB,qBAAa,SAAQ;AAAA,MACtB;AAAA,IACH,CAAC;AAGD,UAAM,aAAa,CAAC,eAAe;AACjC,UAAI,CAAC;AAAY,eAAO;AAExB,YAAM,OAAO,IAAI,KAAK,UAAU;AAGhC,aAAO,KAAK,YAAW,IAAK,OACvB,KAAK,SAAU,IAAG,GAAG,SAAU,EAAC,SAAS,GAAG,GAAG,IAAI,MACpD,KAAK,QAAO,EAAG,SAAQ,EAAG,SAAS,GAAG,GAAG,IAAI,MAC7C,KAAK,SAAQ,EAAG,SAAQ,EAAG,SAAS,GAAG,GAAG,IAAI,MAC9C,KAAK,WAAU,EAAG,SAAQ,EAAG,SAAS,GAAG,GAAG;AAAA,IAClD;AAGA,UAAM,eAAe,CAAC,QAAQ;AAC5BD,oBAAAA,MAAI,aAAa;AAAA,QACf,MAAM,CAAC,GAAG;AAAA,QACV,SAAS;AAAA,MACb,CAAG;AAAA,IACH;AAGA,UAAM,qBAAqB,CAAC,YAAY;AACtCA,oBAAY,MAAA,MAAA,OAAA,qCAAA,uBAAsB,QAAQ,OAAO;AACjD,sBAAgB,QAAQ;AACxBE,oBAAAA,WAAS,MAAM;AACb,0BAAkB,MAAM,KAAK,OAAO;AAAA,MACxC,CAAG;AAAA,IACH;AAGA,UAAM,sBAAsB,OAAO,gBAAgB;AACjD,YAAM,aAAa,cAAc,WAAW;AAAA,IAC9C;AAGA,UAAM,sBAAsB,OAAO,gBAAgB;AACjD,YAAM,aAAa,cAAc,WAAW;AAAA,IAC9C;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AC7EA,GAAG,WAAWC,SAAe;"}