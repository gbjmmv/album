{"version":3,"file":"FavoritesPage.js","sources":["pages/FavoritesPage/FavoritesPage.vue","../../HBuilderX.4.45.2025010502/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvRmF2b3JpdGVzUGFnZS9GYXZvcml0ZXNQYWdlLnZ1ZQ"],"sourcesContent":["<script setup>\nimport { ref, computed, onMounted } from 'vue';\nimport { onLoad, onShow } from '@dcloudio/uni-app';\nimport { usePhotoStore } from '@/stores/photo';\nimport { getAvatarUrl } from '@/utils/url.js';\n\n// 状态\nconst isSelectMode = ref(false);\nconst selectedPhotoIds = ref([]);\nconst favoritePopup = ref(null);\n// 获取照片store\nconst photoStore = usePhotoStore();\nconst photos = computed(() =>photoStore.favoritePhotos);\nconst isLoading = computed(() => photoStore.isLoading);\n\n// 每次显示页面时刷新数据\nonShow(() => {\n  fetchFavorites();\n});\n\nonLoad(()=>{\n  fetchFavorites();\n})\n\n// 加载收藏的照片\nconst fetchFavorites = async () => {\n  await photoStore.getFavoritePhotos();\n};\n\n// 进入照片选择模式\nconst enterSelectMode = () => {\n  isSelectMode.value = true;\n  selectedPhotoIds.value = [];\n};\n\n// 取消选择模式\nconst cancelSelect = () => {\n  isSelectMode.value = false;\n  selectedPhotoIds.value = [];\n};\n\n// 切换照片选择状态\nconst toggleSelect = (photo) => {\n  const index = selectedPhotoIds.value.findIndex(id => id === photo.id);\n  if (index > -1) {\n    selectedPhotoIds.value.splice(index, 1);\n  } else {\n    selectedPhotoIds.value.push(photo.id);\n  }\n};\n\n// 判断照片是否已选中\nconst isPhotoSelected = (photo) => {\n  return selectedPhotoIds.value.includes(photo.id);\n};\n\n// 查看照片\nconst viewPhoto = (photo, index) => {\n  // 导航到照片详情页，传递照片ID和当前照片列表索引\n  // 特殊处理：传递source=favorites表示来源是收藏页面\n  uni.navigateTo({\n    url: `/pages/PhotoDetail/PhotoDetail?id=${photo.id}&index=${index}&source=favorites`\n  });\n};\n\n// 显示取消收藏确认弹窗\nconst showDeleteConfirm = () => {\n  if (!favoritePopup.value) return;\n  favoritePopup.value.open();\n};\n\n// 关闭取消收藏确认弹窗\nconst closeFavoritePopup = () => {\n  if (!favoritePopup.value) return;\n  favoritePopup.value.close();\n};\n\n// 确认取消收藏选中照片\nconst confirmRemoveFavorites = async () => {\n  if (selectedPhotoIds.value.length === 0) return;\n\n  let success = true;\n  for (const photoId of selectedPhotoIds.value) {\n    const result = await photoStore.toggleFavorite(photoId);\n    if (!result) {\n      success = false;\n    }\n  }\n\n  if (success) {\n    // 刷新收藏列表\n    await photoStore.getFavoritePhotos();\n\n    // 清空选中照片\n    selectedPhotoIds.value = [];\n    // 退出选择模式\n    isSelectMode.value = false;\n\n    uni.showToast({\n      title: '取消收藏成功',\n      icon: 'success'\n    });\n  }\n\n  closeFavoritePopup();\n};\n</script>\n\n\n<template>\n  <view class=\"favorites-page\">\n    <view class=\"header\">\n      <view class=\"title\">我的收藏</view>\n      <view class=\"actions\" v-if=\"photos.length > 0\">\n        <button v-if=\"isSelectMode\" @click=\"cancelSelect\" class=\"cancel-btn\">取消</button>\n        <button v-else @click=\"enterSelectMode\" class=\"select-btn\">选择</button>\n        <button v-if=\"isSelectMode && selectedPhotoIds.length > 0\" @click=\"showDeleteConfirm\" class=\"delete-btn\">取消收藏({{ selectedPhotoIds.length }})</button>\n      </view>\n    </view>\n\n    <view class=\"photos-grid\" v-if=\"photos.length > 0\">\n      <view\n          v-for=\"(photo, index) in photos\"\n          :key=\"photo.id\"\n          class=\"photo-item\"\n          @click=\"isSelectMode ? toggleSelect(photo) : viewPhoto(photo, index)\"\n      >\n        <image :src=\"getAvatarUrl(photo.url)\" mode=\"aspectFill\" class=\"photo-image\" />\n        <view v-if=\"isSelectMode\" class=\"select-overlay\" :class=\"{ selected: isPhotoSelected(photo) }\">\n          <uni-icons v-if=\"isPhotoSelected(photo)\" type=\"checkbox-filled\" size=\"24\" color=\"#FFFFFF\" />\n        </view>\n      </view>\n    </view>\n\n    <!-- 空状态提示 -->\n    <view v-if=\"!isLoading && photos.length === 0\" class=\"empty-state\">\n      <image src=\"/static/images/empty-favorites.png\" mode=\"aspectFit\" class=\"empty-image\" />\n      <text class=\"empty-text\">暂无收藏的照片</text>\n      <text class=\"empty-subtext\">浏览相册时点击收藏按钮即可收藏照片</text>\n    </view>\n\n    <!-- 加载状态 -->\n    <uni-load-more v-if=\"isLoading\" status=\"loading\" />\n\n    <!-- 删除确认弹窗 -->\n    <uni-popup ref=\"favoritePopup\" type=\"dialog\">\n      <uni-popup-dialog\n          type=\"warning\"\n          title=\"取消收藏\"\n          content=\"确定要取消收藏所选照片吗？\"\n          :before-close=\"true\"\n          @confirm=\"confirmRemoveFavorites\"\n          @close=\"closeFavoritePopup\"\n      />\n    </uni-popup>\n  </view>\n</template>\n\n\n\n<style>\n.favorites-page {\n  padding: 20rpx;\n  min-height: 100vh;\n}\n\n.header {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: 30rpx;\n}\n\n.title {\n  font-size: 36rpx;\n  font-weight: bold;\n}\n\n.actions {\n  display: flex;\n  gap: 20rpx;\n}\n\n\n\n\n.select-btn, .cancel-btn, .delete-btn {\n  font-size: 24rpx;\n  padding: 6rpx 20rpx;\n  box-shadow: 0 2rpx 6rpx rgba(0, 0, 0, 0.1); /* 添加轻微的阴影 */\n  transition: all 0.2s ease; /* 添加过渡效果 */\n}\n\n.select-btn {\n  background-color: #f8f8f8;\n  color: #333;\n}\n\n.select-btn:hover {\n  background-color: #e0e0e0; /* 鼠标悬停时背景色变深 */\n  box-shadow: 0 4rpx 8rpx rgba(0, 0, 0, 0.15); /* 悬停时阴影加深 */\n}\n\n.cancel-btn {\n  background-color: #f0f0f0;\n  color: #666;\n}\n\n.cancel-btn:hover {\n  background-color: #d9d9d9; /* 鼠标悬停时背景色变深 */\n  box-shadow: 0 4rpx 8rpx rgba(0, 0, 0, 0.15); /* 悬停时阴影加深 */\n}\n\n.delete-btn {\n  background-color: #ff4d4f;\n  color: #fff;\n}\n\n.delete-btn:hover {\n  background-color: #ff1a1d; /* 鼠标悬停时背景色变深 */\n  box-shadow: 0 4rpx 8rpx rgba(255, 77, 79, 0.3); /* 悬停时阴影加深 */\n}\n\n\n\n.photos-grid {\n  display: flex;\n  flex-wrap: wrap;\n  margin: -5rpx;\n}\n\n.photo-item {\n  position: relative;\n  width: calc(33.333% - 10rpx);\n  padding-bottom: calc(33.333% - 10rpx);\n  margin: 5rpx;\n  overflow: hidden;\n}\n\n.photo-image {\n  position: absolute;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n  object-fit: cover;\n}\n\n.select-overlay {\n  position: absolute;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background-color: rgba(0, 0, 0, 0.2);\n  display: flex;\n  justify-content: center;\n  align-items: center;\n}\n\n.select-overlay.selected {\n  background-color: rgba(0, 0, 0, 0.5);\n  border: 4rpx solid #1890ff;\n}\n\n.empty-state {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  padding: 100rpx 0;\n}\n\n.empty-image {\n  width: 200rpx;\n  height: 200rpx;\n  margin-bottom: 20rpx;\n}\n\n.empty-text {\n  color: #666;\n  font-size: 32rpx;\n  margin-bottom: 10rpx;\n}\n\n.empty-subtext {\n  color: #999;\n  font-size: 26rpx;\n}\n</style>\n","import MiniProgramPage from 'C:/Users/ADMIN/Documents/HBuilderProjects/album/pages/FavoritesPage/FavoritesPage.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","usePhotoStore","computed","onShow","onLoad","uni","MiniProgramPage"],"mappings":";;;;;;;;;;;;;;;;;;;;;;AAOA,UAAM,eAAeA,cAAAA,IAAI,KAAK;AAC9B,UAAM,mBAAmBA,cAAAA,IAAI,CAAA,CAAE;AAC/B,UAAM,gBAAgBA,cAAAA,IAAI,IAAI;AAE9B,UAAM,aAAaC,aAAa,cAAA;AAChC,UAAM,SAASC,cAAQ,SAAC,MAAK,WAAW,cAAc;AACtD,UAAM,YAAYA,cAAQ,SAAC,MAAM,WAAW,SAAS;AAGrDC,kBAAAA,OAAO,MAAM;AACX;IACF,CAAC;AAEDC,kBAAAA,OAAO,MAAI;AACT;IACF,CAAC;AAGD,UAAM,iBAAiB,YAAY;AACjC,YAAM,WAAW;IACnB;AAGA,UAAM,kBAAkB,MAAM;AAC5B,mBAAa,QAAQ;AACrB,uBAAiB,QAAQ;IAC3B;AAGA,UAAM,eAAe,MAAM;AACzB,mBAAa,QAAQ;AACrB,uBAAiB,QAAQ;IAC3B;AAGA,UAAM,eAAe,CAAC,UAAU;AAC9B,YAAM,QAAQ,iBAAiB,MAAM,UAAU,QAAM,OAAO,MAAM,EAAE;AACpE,UAAI,QAAQ,IAAI;AACd,yBAAiB,MAAM,OAAO,OAAO,CAAC;AAAA,MAC1C,OAAS;AACL,yBAAiB,MAAM,KAAK,MAAM,EAAE;AAAA,MACrC;AAAA,IACH;AAGA,UAAM,kBAAkB,CAAC,UAAU;AACjC,aAAO,iBAAiB,MAAM,SAAS,MAAM,EAAE;AAAA,IACjD;AAGA,UAAM,YAAY,CAAC,OAAO,UAAU;AAGlCC,oBAAAA,MAAI,WAAW;AAAA,QACb,KAAK,qCAAqC,MAAM,EAAE,UAAU,KAAK;AAAA,MACrE,CAAG;AAAA,IACH;AAGA,UAAM,oBAAoB,MAAM;AAC9B,UAAI,CAAC,cAAc;AAAO;AAC1B,oBAAc,MAAM;IACtB;AAGA,UAAM,qBAAqB,MAAM;AAC/B,UAAI,CAAC,cAAc;AAAO;AAC1B,oBAAc,MAAM;IACtB;AAGA,UAAM,yBAAyB,YAAY;AACzC,UAAI,iBAAiB,MAAM,WAAW;AAAG;AAEzC,UAAI,UAAU;AACd,iBAAW,WAAW,iBAAiB,OAAO;AAC5C,cAAM,SAAS,MAAM,WAAW,eAAe,OAAO;AACtD,YAAI,CAAC,QAAQ;AACX,oBAAU;AAAA,QACX;AAAA,MACF;AAED,UAAI,SAAS;AAEX,cAAM,WAAW;AAGjB,yBAAiB,QAAQ;AAEzB,qBAAa,QAAQ;AAErBA,sBAAAA,MAAI,UAAU;AAAA,UACZ,OAAO;AAAA,UACP,MAAM;AAAA,QACZ,CAAK;AAAA,MACF;AAED;IACF;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACxGA,GAAG,WAAWC,SAAe;"}