{"version":3,"file":"AlbumPage.js","sources":["pages/AlbumPage/AlbumPage.vue","../../HBuilderX.4.45.2025010502/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvQWxidW1QYWdlL0FsYnVtUGFnZS52dWU"],"sourcesContent":["<script setup>\nimport { ref, computed, onMounted } from 'vue'\nimport { onLoad, onShow } from '@dcloudio/uni-app'\nimport { usePhotoStore } from '@/stores/photo.js'\nimport { getAvatarUrl } from '@/utils/url.js'\n\n// 获取路由参数\nconst albumId = ref(null)\nconst albumName = ref('')\nconst isSelectMode = ref(false)\nconst selectedPhotoIds = ref([])\nconst deletePopup = ref(null)\n\n// 获取照片store\nconst photoStore = usePhotoStore()\nconst photos = computed(() => photoStore.currentAlbumPhotos)\nconst isLoading = computed(() => photoStore.isLoading)\n\n// 从路由获取小相册ID\nonLoad((option) => {\n  albumId.value = option.id\n  albumName.value = decodeURIComponent(option.name) || '相册'\n\n\n})\n\n// 每次显示页面时刷新数据\nonShow(() => {\n  fetchPhotos()\n})\n\n// 加载相册照片\nconst fetchPhotos = async () => {\n  if (!albumId.value) return\n  await photoStore.getAlbumPhotos(albumId.value)\n}\n\n// 进入照片选择模式\nconst enterSelectMode = () => {\n  isSelectMode.value = true\n  selectedPhotoIds.value = []\n}\n\n// 取消选择模式\nconst cancelSelect = () => {\n  isSelectMode.value = false\n  selectedPhotoIds.value = []\n}\n\n// 切换照片选择状态\nconst toggleSelect = (photo) => {\n  const index = selectedPhotoIds.value.findIndex(id => id === photo.id)\n  if (index > -1) {\n    selectedPhotoIds.value.splice(index, 1)\n  } else {\n    selectedPhotoIds.value.push(photo.id)\n  }\n}\n\n// 判断照片是否已选中\nconst isPhotoSelected = (photo) => {\n  return selectedPhotoIds.value.includes(photo.id)\n}\n\n// 查看照片\nconst viewPhoto = (photo, index) => {\n  // 导航到照片详情页，传递照片ID和当前相册中的照片列表索引\n  uni.navigateTo({\n    url: `/pages/PhotoDetail/PhotoDetail?id=${photo.id}&index=${index}`\n  })\n}\n\n// 显示删除确认弹窗\nconst showDeleteConfirm = () => {\n  if (!deletePopup.value) return\n  deletePopup.value.open()\n}\n\n// 关闭删除确认弹窗\nconst closeDeletePopup = () => {\n  if (!deletePopup.value) return\n  deletePopup.value.close()\n}\n\n// 确认删除选中照片\nconst confirmDelete = async () => {\n  if (selectedPhotoIds.value.length === 0) return\n\n  const success = await photoStore.batchDeletePhotos(selectedPhotoIds.value)\n\n  if (success) {\n    // 清空选中照片\n    selectedPhotoIds.value = []\n    // 退出选择模式\n    isSelectMode.value = false\n  }\n\n  closeDeletePopup()\n}\n\n// 选择并上传图片到当前相册\nconst chooseImages = () => {\n  console.log(\"albumId.value: \",albumId.value)\n  uni.chooseImage({\n    count: 9,\n    sourceType: ['album'],\n    success: (res) => {\n      // 处理选择的图片\n      uni.setStorageSync('selectedMediaFiles', res.tempFilePaths);\n      // 传递相册ID到确认页面\n      uni.navigateTo({\n        url: `/pages/confirm/confirm?albumId=${albumId.value}`\n      });\n    },\n    fail: (err) => {\n      uni.showToast({\n        title: '选择图片失败',\n        icon: 'none'\n      });\n    }\n  });\n}\n</script>\n\n<template>\n  <view class=\"album-page\">\n    <view class=\"header\">\n      <view class=\"title\">{{ albumName }}</view>\n      <view class=\"actions\">\n        <button v-if=\"isSelectMode\" @click=\"cancelSelect\" class=\"cancel-btn\">取消</button>\n        <button v-else @click=\"enterSelectMode\" class=\"select-btn\">选择</button>\n        <button v-if=\"isSelectMode && selectedPhotoIds.length > 0\" @click=\"showDeleteConfirm\" class=\"delete-btn\">删除({{ selectedPhotoIds.length }})</button>\n      </view>\n    </view>\n\n    <view class=\"photos-grid\">\n      <view\n          v-for=\"(photo, index) in photos\"\n          :key=\"photo.id\"\n          class=\"photo-item\"\n          @click=\"isSelectMode ? toggleSelect(photo) : viewPhoto(photo, index)\"\n      >\n        <image :src=\"getAvatarUrl(photo.url)\" mode=\"aspectFill\" class=\"photo-image\" />\n        <view v-if=\"isSelectMode\" class=\"select-overlay\" :class=\"{ selected: isPhotoSelected(photo) }\">\n          <uni-icons v-if=\"isPhotoSelected(photo)\" type=\"checkbox-filled\" size=\"24\" color=\"#FFFFFF\" />\n        </view>\n      </view>\n    </view>\n\n    <!-- 删除确认弹窗 -->\n    <uni-popup ref=\"deletePopup\" type=\"dialog\">\n      <uni-popup-dialog\n          type=\"warning\"\n          title=\"删除照片\"\n          content=\"确定要删除所选照片吗？此操作不可撤销。\"\n          :before-close=\"true\"\n          @confirm=\"confirmDelete\"\n          @close=\"closeDeletePopup\"\n      />\n    </uni-popup>\n\n    <!-- 空状态提示 -->\n    <view v-if=\"!isLoading && photos.length === 0\" class=\"empty-state\">\n      <image src=\"/static/images/empty-album.png\" mode=\"aspectFit\" class=\"empty-image\" />\n      <text class=\"empty-text\">相册里还没有照片</text>\n    </view>\n\n    <!-- 加载状态 -->\n    <uni-load-more v-if=\"isLoading\" status=\"loading\" />\n\n    <!-- 添加悬浮的上传按钮 -->\n    <view class=\"floating-button\" @click=\"chooseImages\">\n      <uni-icons type=\"plus\" size=\"40\" color=\"#FFFFFF\" />\n    </view>\n  </view>\n</template>\n\n\n\n<style>\n.album-page {\n  padding: 20rpx;\n  min-height: 100vh;\n}\n\n.header {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: 30rpx;\n}\n\n.title {\n  font-size: 36rpx;\n  font-weight: bold;\n}\n\n.actions {\n  display: flex;\n  gap: 20rpx;\n}\n\n.select-btn, .cancel-btn, .delete-btn {\n  font-size: 24rpx;\n  padding: 6rpx 20rpx;\n  box-shadow: 0 2rpx 6rpx rgba(0, 0, 0, 0.1); /* 添加轻微的阴影 */\n  transition: all 0.2s ease; /* 添加过渡效果 */\n}\n\n.select-btn {\n  background-color: #f8f8f8;\n  color: #333;\n}\n\n.select-btn:hover {\n  background-color: #e0e0e0; /* 鼠标悬停时背景色变深 */\n  box-shadow: 0 4rpx 8rpx rgba(0, 0, 0, 0.15); /* 悬停时阴影加深 */\n}\n\n.cancel-btn {\n  background-color: #f0f0f0;\n  color: #666;\n}\n\n.cancel-btn:hover {\n  background-color: #d9d9d9; /* 鼠标悬停时背景色变深 */\n  box-shadow: 0 4rpx 8rpx rgba(0, 0, 0, 0.15); /* 悬停时阴影加深 */\n}\n\n.delete-btn {\n  background-color: #ff4d4f;\n  color: #fff;\n}\n\n.delete-btn:hover {\n  background-color: #ff1a1d; /* 鼠标悬停时背景色变深 */\n  box-shadow: 0 4rpx 8rpx rgba(255, 77, 79, 0.3); /* 悬停时阴影加深 */\n}\n\n\n.photos-grid {\n  display: flex;\n  flex-wrap: wrap;\n  margin: -5rpx;\n}\n\n.photo-item {\n  position: relative;\n  width: calc(33.333% - 10rpx);\n  padding-bottom: calc(33.333% - 10rpx);\n  margin: 5rpx;\n  overflow: hidden;\n}\n\n.photo-image {\n  position: absolute;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n  object-fit: cover;\n}\n\n.select-overlay {\n  position: absolute;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background-color: rgba(0, 0, 0, 0.2);\n  display: flex;\n  justify-content: center;\n  align-items: center;\n}\n\n.select-overlay.selected {\n  background-color: rgba(0, 0, 0, 0.5);\n  border: 4rpx solid #1890ff;\n}\n\n.empty-state {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  padding: 100rpx 0;\n}\n\n.empty-image {\n  width: 200rpx;\n  height: 200rpx;\n  margin-bottom: 20rpx;\n}\n\n.empty-text {\n  color: #999;\n  font-size: 28rpx;\n}\n\n/* 悬浮上传按钮样式 */\n.floating-button {\n  position: fixed;\n  right: 80rpx;\n  bottom: 120rpx;\n  width: 150rpx;\n  height: 150rpx;\n  border-radius: 50%;\n  background-color: #28b389;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  box-shadow: 0 4rpx 12rpx rgba(40, 179, 137, 0.4);\n  z-index: 100;\n  transition: all 0.3s ease;\n}\n\n.floating-button:active {\n  transform: scale(0.8);\n  box-shadow: 0 2rpx 8rpx rgba(40, 179, 137, 0.3);\n}\n</style>","import MiniProgramPage from 'C:/Users/ADMIN/Documents/HBuilderProjects/宝宝照片/pages/AlbumPage/AlbumPage.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","usePhotoStore","computed","onLoad","onShow","uni","MiniProgramPage"],"mappings":";;;;;;;;;;;;;;;;;;;;;;AAOA,UAAM,UAAUA,cAAG,IAAC,IAAI;AACxB,UAAM,YAAYA,cAAG,IAAC,EAAE;AACxB,UAAM,eAAeA,cAAG,IAAC,KAAK;AAC9B,UAAM,mBAAmBA,cAAG,IAAC,EAAE;AAC/B,UAAM,cAAcA,cAAG,IAAC,IAAI;AAG5B,UAAM,aAAaC,aAAAA,cAAe;AAClC,UAAM,SAASC,cAAQ,SAAC,MAAM,WAAW,kBAAkB;AAC3D,UAAM,YAAYA,cAAQ,SAAC,MAAM,WAAW,SAAS;AAGrDC,kBAAM,OAAC,CAAC,WAAW;AACjB,cAAQ,QAAQ,OAAO;AACvB,gBAAU,QAAQ,mBAAmB,OAAO,IAAI,KAAK;AAAA,IAGvD,CAAC;AAGDC,kBAAAA,OAAO,MAAM;AACX,kBAAa;AAAA,IACf,CAAC;AAGD,UAAM,cAAc,YAAY;AAC9B,UAAI,CAAC,QAAQ;AAAO;AACpB,YAAM,WAAW,eAAe,QAAQ,KAAK;AAAA,IAC/C;AAGA,UAAM,kBAAkB,MAAM;AAC5B,mBAAa,QAAQ;AACrB,uBAAiB,QAAQ,CAAE;AAAA,IAC7B;AAGA,UAAM,eAAe,MAAM;AACzB,mBAAa,QAAQ;AACrB,uBAAiB,QAAQ,CAAE;AAAA,IAC7B;AAGA,UAAM,eAAe,CAAC,UAAU;AAC9B,YAAM,QAAQ,iBAAiB,MAAM,UAAU,QAAM,OAAO,MAAM,EAAE;AACpE,UAAI,QAAQ,IAAI;AACd,yBAAiB,MAAM,OAAO,OAAO,CAAC;AAAA,MAC1C,OAAS;AACL,yBAAiB,MAAM,KAAK,MAAM,EAAE;AAAA,MACrC;AAAA,IACH;AAGA,UAAM,kBAAkB,CAAC,UAAU;AACjC,aAAO,iBAAiB,MAAM,SAAS,MAAM,EAAE;AAAA,IACjD;AAGA,UAAM,YAAY,CAAC,OAAO,UAAU;AAElCC,oBAAAA,MAAI,WAAW;AAAA,QACb,KAAK,qCAAqC,MAAM,EAAE,UAAU,KAAK;AAAA,MACrE,CAAG;AAAA,IACH;AAGA,UAAM,oBAAoB,MAAM;AAC9B,UAAI,CAAC,YAAY;AAAO;AACxB,kBAAY,MAAM,KAAM;AAAA,IAC1B;AAGA,UAAM,mBAAmB,MAAM;AAC7B,UAAI,CAAC,YAAY;AAAO;AACxB,kBAAY,MAAM,MAAO;AAAA,IAC3B;AAGA,UAAM,gBAAgB,YAAY;AAChC,UAAI,iBAAiB,MAAM,WAAW;AAAG;AAEzC,YAAM,UAAU,MAAM,WAAW,kBAAkB,iBAAiB,KAAK;AAEzE,UAAI,SAAS;AAEX,yBAAiB,QAAQ,CAAE;AAE3B,qBAAa,QAAQ;AAAA,MACtB;AAED,uBAAkB;AAAA,IACpB;AAGA,UAAM,eAAe,MAAM;AACzBA,oBAAA,MAAA,MAAA,OAAA,wCAAY,mBAAkB,QAAQ,KAAK;AAC3CA,oBAAAA,MAAI,YAAY;AAAA,QACd,OAAO;AAAA,QACP,YAAY,CAAC,OAAO;AAAA,QACpB,SAAS,CAAC,QAAQ;AAEhBA,wBAAAA,MAAI,eAAe,sBAAsB,IAAI,aAAa;AAE1DA,wBAAAA,MAAI,WAAW;AAAA,YACb,KAAK,kCAAkC,QAAQ,KAAK;AAAA,UAC5D,CAAO;AAAA,QACF;AAAA,QACD,MAAM,CAAC,QAAQ;AACbA,wBAAAA,MAAI,UAAU;AAAA,YACZ,OAAO;AAAA,YACP,MAAM;AAAA,UACd,CAAO;AAAA,QACF;AAAA,MACL,CAAG;AAAA,IACH;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACxHA,GAAG,WAAWC,SAAe;"}