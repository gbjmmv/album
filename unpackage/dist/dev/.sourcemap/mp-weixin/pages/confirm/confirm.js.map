{"version":3,"file":"confirm.js","sources":["pages/confirm/confirm.vue","../../HBuilderX.4.45.2025010502/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvY29uZmlybS9jb25maXJtLnZ1ZQ"],"sourcesContent":["<script setup>\nimport {ref, watch} from 'vue';\nimport {onShow, onLoad} from '@dcloudio/uni-app'\nimport {useAlbumStore} from '@/stores/album.js'\nimport {getAvatarUrl} from \"@/utils/url\";\nimport {usePhotoStore} from '@/stores/photo.js'\n\nconst albumStore = useAlbumStore()\nconst photoStore = usePhotoStore()\nconst albumList = ref([])\nconst mainAlbumId = uni.getStorageSync('main album')\nconst showIndex = ref(0)\n\n// 读取缓存的相册id和路由传递的相册id\nconst selectedAlbumId = ref();\nconst preselectedAlbumId = ref(null);\n// 是否显示选择相册部分\nconst showAlbumSelector = ref(true);\n\n// 用户选择的图片\nconst imageAddressList = ref([])\nimageAddressList.value = uni.getStorageSync('selectedMediaFiles')\n\nconst getAlbum = async () => {\n  albumList.value = await albumStore.getAlbumList()\n\n  // 如果有预选的相册ID，则选择该相册\n  if (preselectedAlbumId.value) {\n    selectedAlbumId.value = preselectedAlbumId.value\n    // 找到预选相册的索引\n    let found = false\n    for (let i = 0; i < albumList.value.length; i++) {\n      console.log(\"第\",i)\n      console.log(\"albumList.value[i].id： \",albumList.value[i].id)\n      console.log(\"preselectedAlbumId.value： \",preselectedAlbumId.value)\n\n      if (albumList.value[i].id == preselectedAlbumId.value) {\n        showIndex.value = i\n        found = true\n        break\n      }\n    }\n    console.log(found)\n\n    // 如果没找到匹配的相册，为安全起见也设置默认值\n    if (!found) {\n      selectedAlbumId.value = albumList.value[0].id\n      showIndex.value = 0\n    }\n  } else {\n    // 否则默认选择第一个相册\n    selectedAlbumId.value = albumList.value[0].id\n    showIndex.value = 0\n  }\n\n  // 处理相册封面\n  for (let i = 0; i < albumList.value.length; i++) {\n    if (albumList.value[i].coverPhotoUrl) {\n      albumList.value[i].coverPhotoUrl = getAvatarUrl(albumList.value[i].coverPhotoUrl)\n    } else {\n      albumList.value[i].coverPhotoUrl = \"/static/image/classify.png\"\n    }\n  }\n}\n\nonLoad(async (option) => {\n  // 获取路由参数中的相册ID\n  if (option.albumId) {\n    preselectedAlbumId.value = option.albumId\n    // 如果是从相册页面进入，不显示选择相册部分\n    showAlbumSelector.value = false\n  }\n\n  await getAlbum()\n})\n\nonShow(() => {\n  // 如果从相册列表页面返回，更新选中的相册\n  if (albumStore.id_index.value && albumStore.id_index.value.id) {\n    showIndex.value = albumStore.id_index.value.index\n    selectedAlbumId.value = albumStore.id_index.value.id\n  }\n\n  // 确保界面显示正确的相册\n  if (selectedAlbumId.value) {\n    for (let i = 0; i < albumList.value.length; i++) {\n      if (albumList.value[i].id === selectedAlbumId.value) {\n        showIndex.value = i\n        break\n      }\n    }\n  }\n});\n\nconst toAlbumList = () => {\n  uni.navigateTo({\n    url: '/pages/album_list/album_list'\n  });\n}\n\nconst handleClick = () => {\n  // 处理点击相册的事件\n  toAlbumList()\n}\n\n\nconst confirmUpload = async () => {\n  console.log(\"selectedAlbumId.value: \",selectedAlbumId.value)\n  const res = await photoStore.uploadPhotos(\n      imageAddressList.value,\n      selectedAlbumId.value,\n      mainAlbumId\n  )\n  if (res) {\n    uni.showToast({ title: '上传成功', icon: 'success' });\n    uni.removeStorageSync('selectedMediaFiles'); // 清空已选照片缓存\n    uni.navigateBack();\n  }\n}\n</script>\n<template>\n  <view class=\"confirm-container\">\n    <!--选择相册 - 仅在非相册直接上传时显示 -->\n    <view v-if=\"showAlbumSelector\" class=\"choose-album\">\n      <view class=\"text\">选择相册</view>\n\n      <view class=\"container\" @click=\"handleClick\">\n        <view class=\"left\">\n          <image :src=\"albumList[showIndex].coverPhotoUrl\" mode=\"aspectFill\"></image>\n        </view>\n        <view class=\"right\">\n          <view class=\"title\">{{ albumList[showIndex].name }}</view>\n          <view class=\"number\">{{ albumList[showIndex].number }}张</view>\n        </view>\n      </view>\n      <uni-icons @click=\"toAlbumList\" class=\"icon\" type=\"right\" size=\"20\"></uni-icons>\n    </view>\n\n\n\n    <view class=\"showPic\">\n      <image v-for=\"(pic,index) in imageAddressList\" :key=\"index\" :src=\"pic\"></image>\n    </view>\n\n    <!-- 底部上传按钮 -->\n    <view class=\"upload-btn-container\">\n      <button class=\"upload-btn\" @click=\"confirmUpload\">确认上传</button>\n    </view>\n  </view>\n</template>\n\n<style scoped>\n.container .right {\n  padding-right: 35rpx;\n  text-align: right;\n}\n\n\n.container .right .title {\n  font-size: 40rpx;\n}\n\n.container .left image {\n  height: 120rpx;\n  width: 120rpx;\n  border-radius: 10rpx;\n  transform: translateY(7rpx);\n}\n\n.container {\n  display: flex;\n  align-items: center;\n  flex-direction: row-reverse;\n  width: 400rpx;\n  height: 150rpx;\n  transform: translateX(30rpx);\n}\n\n\n.showPic {\n  display: flex;\n  flex-wrap: wrap;\n  padding: 10rpx;\n  gap: 20rpx; /* 设置图片之间的间距 */\n  margin-left: 3rpx;\n  margin-top: 20rpx;\n  margin-bottom: 30rpx\n}\n\n.showPic image {\n  width: 230rpx;\n  object-fit: cover;\n  height: 230rpx;\n}\n\n\n.choose-album .icon {\n  margin-right: 20rpx;\n}\n\n.choose-album .album {\n  margin-left: auto\n}\n\n.choose-album .text {\n  font-size: 40rpx;\n  font-weight: bold;\n  margin-left: 20rpx;\n}\n\n.choose-album {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n}\n\n\n.confirm-container {\n  display: flex;\n  flex-direction: column;\n  min-height: 100vh;\n  background-color: #f7f7f7;\n}\n\n\n.upload-btn-container {\n  padding: 20px 16px;\n  background-color: #ffffff;\n}\n\n.upload-btn {\n  width: 100%;\n  height: 44px;\n  line-height: 44px;\n  background-color: #07c160;\n  color: #ffffff;\n  font-size: 16px;\n  border-radius: 4px;\n}\n</style>\n","import MiniProgramPage from 'C:/Users/ADMIN/Documents/HBuilderProjects/album/pages/confirm/confirm.vue'\nwx.createPage(MiniProgramPage)"],"names":["useAlbumStore","usePhotoStore","ref","uni","getAvatarUrl","onLoad","onShow"],"mappings":"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"}