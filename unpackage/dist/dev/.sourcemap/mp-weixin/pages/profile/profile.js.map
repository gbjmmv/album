{"version":3,"file":"profile.js","sources":["pages/profile/profile.vue","../../HBuilderX.4.45.2025010502/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvcHJvZmlsZS9wcm9maWxlLnZ1ZQ"],"sourcesContent":["<script setup>\nimport {ref} from 'vue'\nimport {useUserStore} from '@/stores/user.js'\nimport {onLoad, onShow} from '@dcloudio/uni-app'\nimport {getAvatarUrl} from '@/utils/url.js'\n\nconst isNicknameEditing = ref(false)\nconst isPartnerIdEditing = ref(false)\nconst handleNicknameEdit = () => {\n  isNicknameEditing.value = true\n  setTimeout(() => {\n  }, 100)\n}\nconst handlePartnerIdEdit = () => {\n  isPartnerIdEditing.value = true\n}\nconst handleNicknameBlur = () => {\n  isNicknameEditing.value = false\n}\nconst handlePartnerIdBlur = () => {\n  isPartnerIdEditing.value = false\n}\nconst userStore = useUserStore()\nconst profile = ref({\n  nickname: '',\n  partner_id: '',\n  avatarFile: null\n})\nconst currentProfile = ref({\n  id: '',\n  nickname: '',\n  partner_id: '',\n  avatarFile: null\n})\nonLoad(() => {\n  const {userInfo} = userStore.getStoredInfo()\n  if (userInfo?.[0]) {\n    currentProfile.value = {\n      id: userInfo[0].id,\n      nickname: userInfo[0].nickname,\n      avatarFile: getAvatarUrl(userInfo[0].avatarUrl),\n      partner_id: userInfo[0].partner_id,\n    }\n  } else {\n    // 处理无用户信息的情况\n    uni.showToast({\n      title: '获取用户信息失败',\n      icon: 'none'\n    })\n    // 可能需要跳转到登录页\n    uni.navigateTo({url: '/pages/user/user'})\n  }\n})\nonShow(async () => {\n  const userInfo = await userStore.getUserInfo()\n  currentProfile.value = {\n    id: userInfo[0].id,\n    nickname: userInfo[0].nickname,\n    avatarFile: getAvatarUrl(userInfo[0].avatarUrl),\n    partner_id: userInfo[0].partner_id,\n  }\n})\n// 选择头像\nconst chooseAvatar = async () => {\n  try {\n    const res = await uni.chooseImage({\n      count: 1,\n      sizeType: ['compressed'],\n      sourceType: ['album', 'camera']\n    })\n    profile.value.avatarFile = res.tempFilePaths[0]\n    currentProfile.value.avatarFile = res.tempFilePaths[0]\n    console.log(res.tempFilePaths[0])\n  } catch (error) {\n    console.error('选择图片失败：', error)\n  }\n}\nconst updateProfile = async () => {\n  const userInfo = await userStore.getUserInfo()\n  console.log(\"userInfo\", userInfo)\n  currentProfile.value = {\n    id: userInfo[0].id,\n    nickname: userInfo[0].nickname,\n    avatarFile: getAvatarUrl(userInfo[0].avatarUrl),\n    partner_id: userInfo[0].partner_id,\n  }\n}\n// 提交个人信息\nconst submitProfile = async () => {\n  try {\n    // 显示加载状态\n    uni.showLoading({\n      title: '更新中...'\n    })\n    const res = await userStore.updateProfile(profile.value)\n    profile.value = {\n      nickname: '',\n      partner_id: '',\n      avatarFile: null\n    }\n    uni.hideLoading()\n    if (res.success) {\n      uni.showToast({\n        title: '更新成功',\n        icon: 'success'\n      })\n    } else {\n      throw new Error(res.error)\n    }\n  } catch (error) {\n    uni.hideLoading()\n    uni.showToast({\n      title: error.message || '更新失败',\n      icon: 'none'\n    })\n  }\n  await updateProfile()\n}\nuni.hideLoading()\n</script>\n\n<template>\n  <view class=\"profile-container\">\n\n    <view class=\"avatar-section\">\n      <image :src=\"currentProfile.avatarFile\" mode=\"aspectFill\" @tap=\"chooseAvatar\"/>\n      <text>{{ currentProfile.nickname }}</text>\n    </view>\n\n\n    <view class=\"container\">\n      <!-- ID显示 -->\n      <view class=\"info-row\">\n        <text class=\"label\">你的ID:</text>\n        <text class=\"value\">{{ currentProfile.id }}</text>\n      </view>\n\n      <!-- 昵称显示/编辑 -->\n      <view class=\"info-row\">\n        <text class=\"label\">昵称:</text>\n        <view class=\"value-section\">\n          <input v-if=\"isNicknameEditing\"\n                 type=\"text\"\n                 v-model=\"profile.nickname\"\n                 placeholder=\"请输入昵称\"\n                 class=\"input-field\"\n                 @blur=\"handleNicknameBlur\"/>\n          <text v-else class=\"value\">{{ currentProfile.nickname || '未设置' }}</text>\n          <view class=\"icon-wrapper\" @tap=\"handleNicknameEdit\">\n            <uni-icons type=\"compose\"\n                       size=\"20\"\n                       color=\"#666\"\n                       class=\"edit-icon\">\n            </uni-icons>\n          </view>\n        </view>\n      </view>\n\n      <!-- 伴侣ID显示/编辑 -->\n      <view class=\"info-row\">\n        <text class=\"label\">伴侣ID:</text>\n        <view class=\"value-section\">\n          <input v-if=\"isPartnerIdEditing\"\n                 type=\"text\"\n                 v-model=\"profile.partner_id\"\n                 placeholder=\"请输入伴侣ID\"\n                 class=\"input-field\"\n                 @blur=\"handlePartnerIdBlur\"/>\n          <text v-else class=\"value\">{{ currentProfile.partner_id || '未设置' }}</text>\n          <view class=\"icon-wrapper\" @tap=\"handlePartnerIdEdit\">\n            <uni-icons type=\"compose\"\n                       size=\"20\"\n                       color=\"#666\"\n                       class=\"edit-icon\">\n            </uni-icons>\n          </view>\n        </view>\n      </view>\n    </view>\n\n\n    <!-- 提交按钮 -->\n    <button @tap=\"submitProfile\" type=\"primary\">确认修改</button>\n  </view>\n</template>\n\n\n<style>\n.container {\n  padding: 30rpx;\n}\n\n.info-row {\n  display: flex;\n  align-items: center;\n  padding: 30rpx 0;\n  border-bottom: 1px solid #eee;\n}\n\n.label {\n  width: 140rpx;\n  font-size: 28rpx;\n  color: #666;\n}\n\n.value-section {\n  flex: 1;\n  display: flex;\n  align-items: center;\n}\n\n.value {\n  flex: 1;\n  font-size: 28rpx;\n  color: #333;\n}\n\n.input-field {\n  flex: 1;\n  font-size: 28rpx;\n  padding: 10rpx 0;\n  border-bottom: 1px solid #007AFF;\n}\n\n.edit-icon {\n  margin-left: 20rpx;\n  padding: 10rpx;\n}\n\n/* 点击状态 */\n.edit-icon:active {\n  opacity: 0.7;\n}\n\n\n.avatar-section {\n  background: linear-gradient(to bottom, skyblue, white);\n  background-size: cover;\n  background-position: center;\n  height: 450rpx;\n  display: flex;\n  flex-direction: column;\n  justify-content: center;\n  align-items: center;\n  position: relative;\n}\n\n\n.avatar-section::before {\n  content: '';\n  position: absolute;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  backdrop-filter: blur(8px);\n  -webkit-backdrop-filter: blur(8px);\n  z-index: 1;\n}\n\n\n.avatar-section image,\n.avatar-section text {\n  position: relative;\n  z-index: 2;\n}\n\n.avatar-section text {\n  color: #000000;\n  font-size: 42rpx;\n  font-weight: bold;\n}\n\n\n.avatar-section image {\n  width: 150px;\n  height: 150px;\n  border-radius: 50%;\n  margin-bottom: 40rpx;\n}\n\n</style>\n","import MiniProgramPage from 'C:/Users/ADMIN/Documents/HBuilderProjects/宝宝照片/pages/profile/profile.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","useUserStore","onLoad","getAvatarUrl","uni","onShow","MiniProgramPage"],"mappings":"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"}