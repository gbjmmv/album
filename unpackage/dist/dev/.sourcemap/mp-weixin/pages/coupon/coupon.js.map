{"version":3,"file":"coupon.js","sources":["pages/coupon/coupon.vue","../../HBuilderX.4.45.2025010502/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvY291cG9uL2NvdXBvbi52dWU"],"sourcesContent":["<template>\n  <view class=\"coupon-page\">\n    <!-- 顶部切换选项卡 -->\n    <view class=\"tab-container\">\n      <view\n          v-for=\"(tab, index) in tabs\"\n          :key=\"index\"\n          class=\"tab-item\"\n          :class=\"{ active: activeTab === index }\"\n          @click=\"activeTab = index\"\n      >\n        <text>{{ tab.name }}</text>\n        <view v-if=\"activeTab === index\" class=\"tab-line\"></view>\n      </view>\n    </view>\n\n    <!-- 内容区域 -->\n    <view class=\"content-area\" :class=\"'bg-' + activeTab\">\n      <!-- 创建按钮 -->\n      <view class=\"create-btn\" @click=\"openCreateModal\">\n        <text class=\"create-icon\">+</text>\n        <text>创建兑换券</text>\n      </view>\n\n      <!-- 兑换券列表 -->\n      <scroll-view scroll-y class=\"coupon-list\">\n        <template v-if=\"activeTabCoupons.length > 0\">\n          <view\n              v-for=\"coupon in activeTabCoupons\"\n              :key=\"coupon.id\"\n              class=\"coupon-card\"\n          >\n            <view class=\"coupon-header\">\n              <text class=\"coupon-title\">{{ coupon.title }}</text>\n              <text class=\"coupon-date\">{{ formatDate(coupon.createTime) }}</text>\n            </view>\n            <view v-if=\"coupon.description\" class=\"coupon-desc\">\n              {{ coupon.description }}\n            </view>\n            <view class=\"coupon-footer\">\n              <view class=\"coupon-user\">\n                <template v-if=\"activeTab === 0\">\n                  <text>来自: {{ coupon.creatorNickname }}</text>\n                </template>\n                <template v-if=\"activeTab === 1\">\n                  <text>给予: {{ coupon.receiverNickname }}</text>\n                </template>\n                <template v-if=\"activeTab === 2\">\n                  <text>{{ coupon.creatorNickname }} ⟷ {{ coupon.receiverNickname }}</text>\n                  <text class=\"complete-date\">完成于: {{ formatDate(coupon.completeTime) }}</text>\n                </template>\n              </view>\n              <view v-if=\"activeTab !== 2\" class=\"coupon-actions\">\n                <button class=\"btn complete-btn\" @click=\"handleComplete(coupon.id)\">完成兑现!</button>\n                <button class=\"btn delete-btn\" @click=\"handleDelete(coupon.id)\">删除兑换券</button>\n              </view>\n            </view>\n          </view>\n        </template>\n        <view v-else class=\"empty-list\">\n          <text>暂无{{ tabs[activeTab].name }}的兑换券~</text>\n        </view>\n      </scroll-view>\n    </view>\n\n    <!-- 创建兑换券弹窗 -->\n    <uni-popup ref=\"createPopup\" type=\"center\" background-color=\"#fff\">\n      <view class=\"create-modal\">\n        <view class=\"modal-title\">创建兑换券</view>\n        <view class=\"modal-content\">\n          <view class=\"input-group\">\n            <text class=\"label\">兑换券标题 *</text>\n            <input\n                type=\"text\"\n                v-model=\"newCoupon.title\"\n                placeholder=\"请输入标题\"\n                class=\"input-field\"\n            />\n          </view>\n          <view class=\"input-group\">\n            <text class=\"label\">兑换券详情</text>\n            <textarea\n                v-model=\"newCoupon.description\"\n                placeholder=\"请输入详情（可选）\"\n                class=\"textarea-field\"\n            />\n          </view>\n        </view>\n        <view class=\"modal-footer\">\n          <button class=\"btn cancel-btn\" @click=\"closeCreateModal\">取消</button>\n          <button class=\"btn confirm-btn\" @click=\"confirmCreate\" :disabled=\"!newCoupon.title\">确定</button>\n        </view>\n      </view>\n    </uni-popup>\n\n    <!-- 确认弹窗 -->\n    <uni-popup ref=\"confirmPopup\" type=\"center\" background-color=\"#fff\">\n      <view class=\"confirm-modal\">\n        <view class=\"modal-title\">{{ confirmModalType === 'complete' ? '完成兑现' : '删除兑换券' }}</view>\n        <view class=\"modal-content\">\n          <text>{{ confirmModalType === 'complete' ? '确定要完成兑现这张兑换券吗？' : '确定要删除这张兑换券吗？' }}</text>\n        </view>\n        <view class=\"modal-footer\">\n          <button class=\"btn cancel-btn\" @click=\"closeConfirmModal\">取消</button>\n          <button\n              class=\"btn\"\n              :class=\"confirmModalType === 'complete' ? 'complete-btn' : 'delete-btn'\"\n              @click=\"confirmAction\"\n          >\n            确定\n          </button>\n        </view>\n      </view>\n    </uni-popup>\n  </view>\n</template>\n\n<script setup>\nimport { ref, computed, onMounted } from 'vue'\nimport { useCouponStore } from '@/stores/coupon'\n\n// 获取store\nconst couponStore = useCouponStore()\n\n// 标签页配置\nconst tabs = [\n  { name: '待使用', key: 'pendingUse' },\n  { name: '待兑现', key: 'pendingRedeem' },\n  { name: '已完成', key: 'completed' }\n]\n\n// 状态\nconst activeTab = ref(0)\nconst newCoupon = ref({\n  title: '',\n  description: ''\n})\nconst confirmModalType = ref('')\nconst currentCouponId = ref(null)\n\n// 组件引用\nconst createPopup = ref(null)\nconst confirmPopup = ref(null)\n\n// 计算当前标签页的兑换券列表\nconst activeTabCoupons = computed(() => {\n  const key = tabs[activeTab.value].key\n  return couponStore[key]\n})\n\n// 初始化加载数据\nonMounted(async () => {\n  await couponStore.fetchCoupons()\n})\n\n// 格式化日期\nconst formatDate = (dateValue) => {\n  if (!dateValue) return ''\n\n  // 处理数组格式的日期 [year, month, day, hour, minute, second]\n  if (Array.isArray(dateValue)) {\n    const [year, month, day] = dateValue\n    return `${year}-${String(month).padStart(2, '0')}-${String(day).padStart(2, '0')}`\n  }\n\n  // 处理字符串格式的日期\n  const date = new Date(dateValue)\n  return `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')}`\n}\n\n// 打开创建弹窗\nconst openCreateModal = () => {\n  createPopup.value.open('center')\n}\n\n// 关闭创建弹窗\nconst closeCreateModal = () => {\n  createPopup.value.close()\n  newCoupon.value = { title: '', description: '' }\n}\n\n// 确认创建\nconst confirmCreate = async () => {\n  if (!newCoupon.value.title) {\n    uni.showToast({\n      title: '请输入兑换券标题',\n      icon: 'none'\n    })\n    return\n  }\n  const success = await couponStore.createCoupon(newCoupon.value)\n  if (success) {\n    uni.showToast({\n      title: '创建成功！',\n      icon: 'success'\n    })\n    closeCreateModal()\n  }\n}\n\n// 处理完成兑现\nconst handleComplete = (id) => {\n  confirmModalType.value = 'complete'\n  currentCouponId.value = id\n  confirmPopup.value.open('center')\n}\n\n// 处理删除\nconst handleDelete = (id) => {\n  confirmModalType.value = 'delete'\n  currentCouponId.value = id\n  confirmPopup.value.open('center')\n}\n\n// 关闭确认弹窗\nconst closeConfirmModal = () => {\n  confirmPopup.value.close()\n  currentCouponId.value = null\n}\n\n// 确认操作\nconst confirmAction = async () => {\n  if (!currentCouponId.value) return\n\n  let success = false\n  if (confirmModalType.value === 'complete') {\n    success = await couponStore.completeCoupon(currentCouponId.value)\n    if (success) {\n      uni.showToast({\n        title: '兑现成功！',\n        icon: 'success'\n      })\n    }\n  } else {\n    success = await couponStore.deleteCoupon(currentCouponId.value)\n    if (success) {\n      uni.showToast({\n        title: '删除成功',\n        icon: 'success'\n      })\n    }\n  }\n\n  closeConfirmModal()\n}\n</script>\n\n<style scoped>\n.coupon-page {\n  min-height: 100vh;\n  display: flex;\n  flex-direction: column;\n}\n\n/* 标签栏样式 */\n.tab-container {\n  display: flex;\n  justify-content: space-around;\n  background-color: #ffffff;\n  padding: 20rpx 0;\n  box-shadow: 0 2rpx 10rpx rgba(0, 0, 0, 0.1);\n}\n\n.tab-item {\n  position: relative;\n  padding: 16rpx 20rpx;\n  font-size: 30rpx;\n  color: #666;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n}\n\n.tab-item.active {\n  color: #ff6b81;\n  font-weight: bold;\n}\n\n.tab-line {\n  position: absolute;\n  bottom: -10rpx;\n  width: 60rpx;\n  height: 6rpx;\n  background-color: #ff6b81;\n  border-radius: 3rpx;\n}\n\n/* 内容区域样式 */\n.content-area {\n  flex: 1;\n  padding: 30rpx;\n  position: relative;\n}\n\n.bg-0 {\n  background-color: #fff5f7; /* 待使用背景色 */\n}\n\n.bg-1 {\n  background-color: #f0f8ff; /* 待兑现背景色 */\n}\n\n.bg-2 {\n  background-color: #f5fff0; /* 已完成背景色 */\n}\n\n/* 创建按钮 */\n.create-btn {\n  position: fixed;\n  bottom: 80rpx;\n  right: 40rpx;\n  height: 80rpx;\n  background-color: #ff6b81;\n  color: white;\n  border-radius: 50rpx;\n  padding: 12rpx 30rpx;\n  font-size: 26rpx;\n  display: flex;\n  align-items: center;\n  box-shadow: 0 4rpx 8rpx rgba(255, 107, 129, 0.3);\n  z-index: 2;\n}\n\n.create-icon {\n  font-size: 32rpx;\n  margin-right: 8rpx;\n}\n\n/* 兑换券列表 */\n.coupon-list {\n\n  height: calc(100vh - 240rpx);\n}\n\n.coupon-card {\n  background-color: #ffffff;\n  border-radius: 20rpx;\n  padding: 30rpx;\n  margin-bottom: 30rpx;\n  box-shadow: 0 4rpx 12rpx rgba(0, 0, 0, 0.05);\n}\n\n.coupon-header {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: 16rpx;\n}\n\n.coupon-title {\n  font-size: 32rpx;\n  font-weight: bold;\n  color: #333;\n}\n\n.coupon-date {\n  font-size: 24rpx;\n  color: #999;\n}\n\n.coupon-desc {\n  font-size: 28rpx;\n  color: #666;\n  margin-bottom: 20rpx;\n  line-height: 1.5;\n}\n\n.coupon-footer {\n  display: flex;\n  flex-direction: column;\n  gap: 20rpx;\n}\n\n.coupon-user {\n  font-size: 26rpx;\n  color: #888;\n  display: flex;\n  flex-direction: column;\n}\n\n.complete-date {\n  margin-top: 10rpx;\n  font-size: 24rpx;\n}\n\n.coupon-actions {\n  display: flex;\n  justify-content: flex-end;\n  gap: 20rpx;\n}\n\n.btn {\n  font-size: 24rpx;\n  padding: 10rpx 24rpx;\n  border-radius: 30rpx;\n  border: none;\n}\n\n.complete-btn {\n  background-color: #42b983;\n  color: white;\n}\n\n.delete-btn {\n  background-color: #ff6b6b;\n  color: white;\n}\n\n.cancel-btn {\n  background-color: #f5f5f5;\n  color: #666;\n  width: 150rpx;\n  border-radius:10rpx;\n}\n\n.confirm-btn {\n  background-color: #4285f4;\n  color: white;\n  width: 150rpx;\n  border-radius:10rpx;\n}\n\n\n/* 空列表提示 */\n.empty-list {\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  height: 300rpx;\n  color: #999;\n  font-size: 28rpx;\n}\n\n/* 创建兑换券弹窗 */\n.create-modal {\n  width: 650rpx;\n  background-color: #ffffff;\n  border-radius: 20rpx;\n  padding: 40rpx;\n}\n\n.modal-title {\n  text-align: center;\n  font-size: 32rpx;\n  font-weight: bold;\n  margin-bottom: 30rpx;\n}\n\n.modal-content {\n  margin-bottom: 30rpx;\n}\n\n.input-group {\n  margin-bottom: 20rpx;\n}\n\n.label {\n  display: block;\n  font-size: 28rpx;\n  color: #666;\n  margin-bottom: 10rpx;\n}\n\n.input-field {\n  width: 95%;\n  height: 80rpx;\n  border: 1px solid #eee;\n  border-radius: 10rpx;\n  padding: 0 20rpx;\n  font-size: 28rpx;\n}\n\n.textarea-field {\n  width: 95%;\n  height: 200rpx;\n  border: 1px solid #eee;\n  border-radius: 10rpx;\n  padding: 20rpx;\n  font-size: 28rpx;\n}\n\n.modal-footer {\n  display: flex;\n  justify-content: space-around;\n}\n\n/* 确认弹窗 */\n.confirm-modal {\n  width: 500rpx;\n  background-color: #ffffff;\n  border-radius: 20rpx;\n  padding: 40rpx;\n}\n</style>","import MiniProgramPage from 'C:/Users/ADMIN/Documents/HBuilderProjects/宝宝照片/pages/coupon/coupon.vue'\nwx.createPage(MiniProgramPage)"],"names":["useCouponStore","ref","computed","onMounted","uni"],"mappings":";;;;;;;;;;;;;;AA0HA,UAAM,cAAcA,cAAAA,eAAgB;AAGpC,UAAM,OAAO;AAAA,MACX,EAAE,MAAM,OAAO,KAAK,aAAc;AAAA,MAClC,EAAE,MAAM,OAAO,KAAK,gBAAiB;AAAA,MACrC,EAAE,MAAM,OAAO,KAAK,YAAa;AAAA,IACnC;AAGA,UAAM,YAAYC,cAAG,IAAC,CAAC;AACvB,UAAM,YAAYA,cAAAA,IAAI;AAAA,MACpB,OAAO;AAAA,MACP,aAAa;AAAA,IACf,CAAC;AACD,UAAM,mBAAmBA,cAAG,IAAC,EAAE;AAC/B,UAAM,kBAAkBA,cAAG,IAAC,IAAI;AAGhC,UAAM,cAAcA,cAAG,IAAC,IAAI;AAC5B,UAAM,eAAeA,cAAG,IAAC,IAAI;AAG7B,UAAM,mBAAmBC,cAAQ,SAAC,MAAM;AACtC,YAAM,MAAM,KAAK,UAAU,KAAK,EAAE;AAClC,aAAO,YAAY,GAAG;AAAA,IACxB,CAAC;AAGDC,kBAAAA,UAAU,YAAY;AACpB,YAAM,YAAY,aAAc;AAAA,IAClC,CAAC;AAGD,UAAM,aAAa,CAAC,cAAc;AAChC,UAAI,CAAC;AAAW,eAAO;AAGvB,UAAI,MAAM,QAAQ,SAAS,GAAG;AAC5B,cAAM,CAAC,MAAM,OAAO,GAAG,IAAI;AAC3B,eAAO,GAAG,IAAI,IAAI,OAAO,KAAK,EAAE,SAAS,GAAG,GAAG,CAAC,IAAI,OAAO,GAAG,EAAE,SAAS,GAAG,GAAG,CAAC;AAAA,MACjF;AAGD,YAAM,OAAO,IAAI,KAAK,SAAS;AAC/B,aAAO,GAAG,KAAK,YAAW,CAAE,IAAI,OAAO,KAAK,SAAQ,IAAK,CAAC,EAAE,SAAS,GAAG,GAAG,CAAC,IAAI,OAAO,KAAK,SAAS,EAAE,SAAS,GAAG,GAAG,CAAC;AAAA,IACzH;AAGA,UAAM,kBAAkB,MAAM;AAC5B,kBAAY,MAAM,KAAK,QAAQ;AAAA,IACjC;AAGA,UAAM,mBAAmB,MAAM;AAC7B,kBAAY,MAAM,MAAO;AACzB,gBAAU,QAAQ,EAAE,OAAO,IAAI,aAAa,GAAI;AAAA,IAClD;AAGA,UAAM,gBAAgB,YAAY;AAChC,UAAI,CAAC,UAAU,MAAM,OAAO;AAC1BC,sBAAAA,MAAI,UAAU;AAAA,UACZ,OAAO;AAAA,UACP,MAAM;AAAA,QACZ,CAAK;AACD;AAAA,MACD;AACD,YAAM,UAAU,MAAM,YAAY,aAAa,UAAU,KAAK;AAC9D,UAAI,SAAS;AACXA,sBAAAA,MAAI,UAAU;AAAA,UACZ,OAAO;AAAA,UACP,MAAM;AAAA,QACZ,CAAK;AACD,yBAAkB;AAAA,MACnB;AAAA,IACH;AAGA,UAAM,iBAAiB,CAAC,OAAO;AAC7B,uBAAiB,QAAQ;AACzB,sBAAgB,QAAQ;AACxB,mBAAa,MAAM,KAAK,QAAQ;AAAA,IAClC;AAGA,UAAM,eAAe,CAAC,OAAO;AAC3B,uBAAiB,QAAQ;AACzB,sBAAgB,QAAQ;AACxB,mBAAa,MAAM,KAAK,QAAQ;AAAA,IAClC;AAGA,UAAM,oBAAoB,MAAM;AAC9B,mBAAa,MAAM,MAAO;AAC1B,sBAAgB,QAAQ;AAAA,IAC1B;AAGA,UAAM,gBAAgB,YAAY;AAChC,UAAI,CAAC,gBAAgB;AAAO;AAE5B,UAAI,UAAU;AACd,UAAI,iBAAiB,UAAU,YAAY;AACzC,kBAAU,MAAM,YAAY,eAAe,gBAAgB,KAAK;AAChE,YAAI,SAAS;AACXA,wBAAAA,MAAI,UAAU;AAAA,YACZ,OAAO;AAAA,YACP,MAAM;AAAA,UACd,CAAO;AAAA,QACF;AAAA,MACL,OAAS;AACL,kBAAU,MAAM,YAAY,aAAa,gBAAgB,KAAK;AAC9D,YAAI,SAAS;AACXA,wBAAAA,MAAI,UAAU;AAAA,YACZ,OAAO;AAAA,YACP,MAAM;AAAA,UACd,CAAO;AAAA,QACF;AAAA,MACF;AAED,wBAAmB;AAAA,IACrB;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACnPA,GAAG,WAAW,eAAe;"}